<style>
    .fileuploader-theme-thumbnails .fileuploader-thumbnails-input-inner, .fileuploader-theme-thumbnails .fileuploader-item-inner {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100px;
        height: 59px !important;
        border-radius: 15px;
    }
</style>

<style>
    .slider-before, .slider-after {
        user-select: none;
    }
    .custom-image-slider {
        position: relative;
        width: 100%;
        overflow: hidden;
        height: 0;
        /* border:1px solid pink; */
        /* padding-bottom: 75%; */ /* Adjust this value according to your image aspect ratio */
    }   
    .slider-before, .slider-after {
        position: absolute;
        width: 100%;
        display: block;
        top: 0;
        left: 0;
        /* height: 100%; */
        object-fit: contain;
    }
    .slider-after {
        overflow: hidden;
    }
    .slider-handle {
        position: absolute;
        top: 0;
        left: 50%;
        width: 1px;
        height: 100%;
        background-color: #fff;
        cursor: ew-resize;
    }
    .slider-handle::before, .slider-handle::after {
        content: "";
        position: absolute;
        top: 50%;
        transform: translate(0%, -50%);
        width: 0;
        height: 0;
        border-top: 12px solid transparent;
        border-bottom: 12px solid transparent;
        cursor: ew-resize;
        transition: all 0.2s ease-out; /* Add transition property */
    }
    .slider-handle::before {
        left: -24px;
        border-right: 16px solid #fff;
    }
    .slider-handle::after {
        right: -24px;
        border-left: 16px solid #fff;
    }
</style>

<section class="wrapper bg-light " id="topContent">
    <div class="container  px-16">

        <div class="row align-items-center align-content-center justify-content-center">
            <img src="{{asset('/theme/')}}/img/svg/feedbacktool.svg" class=" p-5 col-lg-2 col-md-3 col-6"
                 srcset="{{asset('/theme/')}}/img/svg/feedbacktool.svg" alt="3drenders logo"/>
            <div class="position-relative @if(!$isSubmited) col-lg-7 col-md-8 @else col-lg-10 col-md-9 @endif col-12">
                <div class="carousel owl-carousel gap-small m-0" data-margin="0" data-dots="false" data-nav="true"
                     data-autoplay="false" data-autoplay-timeout="5000"
                     data-responsive='{"0":{"items": "1"}, "768":{"items": "2"}, "992":{"items": "2"}, "1400":{"items": "4"}}'>
                    @foreach($sessionUpload as $file)
                        <div class="item"
                             onclick="getProof('{{$file->id}}', 'img-{{md5($file->id)}}', '{{url('uploads/proofs/'.$file->filePath)}}')">
                            <div class="item-inner ">
                                <div class="card" data-bs-toggle="tooltip" data-bs-placement="right" title="{{$file->oldname}}">
                                    <div class="card-body p-0">
                                        <img class="w-100 imgslist rounded @if($proof->id==$file->id) activeThumb @endif"
                                             id="img-{{md5($file->id)}}"
                                             src="{{url('uploads/proofs/thumbs/'.$file->filePath)}}" alt=""/>

                                    </div>

                                </div>

                            </div>

                        </div>
                    @endforeach
                </div>
                <!-- /.owl-carousel -->
            </div>
            @if(!$isSubmited)
            <div class="py-lg-0 py-md-5 py-5 d-flex justify-content-lg-end justify-content-center align-content-lg-end align-content-center align-items-center  text-right col-lg-3 col-md-4">
                <form class="d-flex gap-2 align-items-center" method="post" id="submitForm" action="{{url('account/submitform')}}" >
                    <input name="sessionId" value="{{$sessionId}}" type="hidden">
                    <button type="button" onclick="confirmSubmit();" class="btn btn-primary btn-sm">Submit All Feedback</button>
                    <button class="btn btn-outline-light btn-sm p-1" type="button" id="projetModalInfoBtn" onclick="showProjectInfo()"
                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="more info" >
                        <svg width="26px" height="26px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier"> 
                                <path d="M12 17V11" stroke="#1C274C" stroke-width="2" stroke-linecap="round"></path> 
                                <circle cx="1" cy="1" r="1" transform="matrix(1 0 0 -1 11 9)" fill="#1C274C"></circle> 
                                <path d="M7 3.33782C8.47087 2.48697 10.1786 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 10.1786 2.48697 8.47087 3.33782 7" stroke="#1C274C" stroke-width="2" stroke-linecap="round"></path> 
                            </g>
                        </svg>
                    </button>
                </form>  
            </div>
            @endif

            @if($isSubmited)
                <div class="row justify-content-between col-12 w-100 align-content-center align-items-center mb-3">
                    <div class="col-6">
                        Feedback submited: {{date('d-m-y h:i A', strtotime($submitedDate))}}
                    </div>
                <div class="col-6 text-right" align="right">
                    <div>
                        <svg width="163" height="28" viewBox="0 0 163 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 5C0 2.23858 2.23858 0 5 0H158C160.761 0 163 2.23858 163 5V17C163 19.7614 160.761 22 158 22H5C2.23858 22 0 19.7614 0 17V5Z" fill="#707070"/>
                            <path d="M132.5 28L125.139 19.75H139.861L132.5 28Z" fill="#707070"/>
                            <path d="M9.608 15.18C9.024 15.18 8.492 15.084 8.012 14.892C7.532 14.7 7.12 14.42 6.776 14.052C6.432 13.684 6.164 13.232 5.972 12.696C5.788 12.152 5.696 11.532 5.696 10.836C5.696 10.14 5.8 9.524 6.008 8.988C6.224 8.444 6.512 7.988 6.872 7.62C7.232 7.252 7.652 6.972 8.132 6.78C8.612 6.588 9.124 6.492 9.668 6.492C10.012 6.492 10.32 6.516 10.592 6.564C10.872 6.612 11.112 6.668 11.312 6.732C11.52 6.796 11.688 6.86 11.816 6.924C11.944 6.988 12.032 7.036 12.08 7.068L11.744 8.028C11.672 7.98 11.568 7.928 11.432 7.872C11.296 7.816 11.14 7.76 10.964 7.704C10.796 7.648 10.608 7.604 10.4 7.572C10.2 7.532 9.996 7.512 9.788 7.512C9.348 7.512 8.952 7.588 8.6 7.74C8.248 7.892 7.948 8.112 7.7 8.4C7.452 8.688 7.26 9.04 7.124 9.456C6.996 9.864 6.932 10.324 6.932 10.836C6.932 11.332 6.988 11.784 7.1 12.192C7.22 12.6 7.396 12.952 7.628 13.248C7.86 13.536 8.148 13.76 8.492 13.92C8.844 14.08 9.252 14.16 9.716 14.16C10.252 14.16 10.696 14.104 11.048 13.992C11.4 13.88 11.664 13.78 11.84 13.692L12.14 14.652C12.084 14.692 11.984 14.744 11.84 14.808C11.696 14.864 11.516 14.92 11.3 14.976C11.084 15.032 10.832 15.08 10.544 15.12C10.256 15.16 9.944 15.18 9.608 15.18ZM15.2734 15.12C14.5854 15.104 14.0974 14.956 13.8094 14.676C13.5214 14.396 13.3774 13.96 13.3774 13.368V5.88L14.4934 5.688V13.188C14.4934 13.372 14.5094 13.524 14.5414 13.644C14.5734 13.764 14.6254 13.86 14.6974 13.932C14.7694 14.004 14.8654 14.06 14.9854 14.1C15.1054 14.132 15.2534 14.16 15.4294 14.184L15.2734 15.12ZM17.7987 15H16.6827V8.76H17.7987V15ZM17.2347 7.632C17.0347 7.632 16.8627 7.568 16.7187 7.44C16.5827 7.304 16.5147 7.124 16.5147 6.9C16.5147 6.676 16.5827 6.5 16.7187 6.372C16.8627 6.236 17.0347 6.168 17.2347 6.168C17.4347 6.168 17.6027 6.236 17.7387 6.372C17.8827 6.5 17.9547 6.676 17.9547 6.9C17.9547 7.124 17.8827 7.304 17.7387 7.44C17.6027 7.568 17.4347 7.632 17.2347 7.632ZM22.4298 15.144C21.9258 15.144 21.4818 15.064 21.0978 14.904C20.7218 14.744 20.4018 14.52 20.1378 14.232C19.8818 13.944 19.6898 13.604 19.5618 13.212C19.4338 12.812 19.3698 12.372 19.3698 11.892C19.3698 11.412 19.4378 10.972 19.5738 10.572C19.7178 10.172 19.9178 9.828 20.1738 9.54C20.4298 9.244 20.7418 9.016 21.1098 8.856C21.4858 8.688 21.9018 8.604 22.3578 8.604C22.6378 8.604 22.9178 8.628 23.1978 8.676C23.4778 8.724 23.7458 8.8 24.0018 8.904L23.7498 9.852C23.5818 9.772 23.3858 9.708 23.1618 9.66C22.9458 9.612 22.7138 9.588 22.4658 9.588C21.8418 9.588 21.3618 9.784 21.0258 10.176C20.6978 10.568 20.5338 11.14 20.5338 11.892C20.5338 12.228 20.5698 12.536 20.6418 12.816C20.7218 13.096 20.8418 13.336 21.0018 13.536C21.1698 13.736 21.3818 13.892 21.6378 14.004C21.8938 14.108 22.2058 14.16 22.5738 14.16C22.8698 14.16 23.1378 14.132 23.3778 14.076C23.6178 14.02 23.8058 13.96 23.9418 13.896L24.0978 14.832C24.0338 14.872 23.9418 14.912 23.8218 14.952C23.7018 14.984 23.5658 15.012 23.4138 15.036C23.2618 15.068 23.0978 15.092 22.9218 15.108C22.7538 15.132 22.5898 15.144 22.4298 15.144ZM27.5519 11.568C27.7919 11.752 28.0439 11.98 28.3079 12.252C28.5799 12.524 28.8439 12.82 29.0999 13.14C29.3639 13.452 29.6119 13.772 29.8439 14.1C30.0759 14.42 30.2719 14.72 30.4319 15H29.1239C28.9559 14.72 28.7599 14.436 28.5359 14.148C28.3199 13.852 28.0919 13.572 27.8519 13.308C27.6119 13.036 27.3679 12.788 27.1199 12.564C26.8719 12.34 26.6359 12.152 26.4119 12V15H25.2959V5.88L26.4119 5.688V11.376C26.6039 11.184 26.8159 10.972 27.0479 10.74C27.2799 10.508 27.5079 10.272 27.7319 10.032C27.9559 9.792 28.1679 9.564 28.3679 9.348C28.5679 9.124 28.7399 8.928 28.8839 8.76H30.1919C30.0079 8.96 29.8079 9.18 29.5919 9.42C29.3759 9.66 29.1519 9.904 28.9199 10.152C28.6879 10.392 28.4519 10.636 28.2119 10.884C27.9799 11.124 27.7599 11.352 27.5519 11.568ZM35.3868 8.76H37.7508V9.696H35.3868V12.576C35.3868 12.888 35.4108 13.148 35.4588 13.356C35.5068 13.556 35.5788 13.716 35.6748 13.836C35.7708 13.948 35.8908 14.028 36.0348 14.076C36.1788 14.124 36.3468 14.148 36.5388 14.148C36.8748 14.148 37.1428 14.112 37.3428 14.04C37.5508 13.96 37.6948 13.904 37.7748 13.872L37.9908 14.796C37.8788 14.852 37.6828 14.92 37.4028 15C37.1228 15.088 36.8028 15.132 36.4428 15.132C36.0188 15.132 35.6668 15.08 35.3868 14.976C35.1148 14.864 34.8948 14.7 34.7268 14.484C34.5588 14.268 34.4388 14.004 34.3668 13.692C34.3028 13.372 34.2708 13.004 34.2708 12.588V7.02L35.3868 6.828V8.76ZM44.5149 11.88C44.5149 12.376 44.4429 12.824 44.2989 13.224C44.1549 13.624 43.9509 13.968 43.6869 14.256C43.4309 14.544 43.1229 14.768 42.7629 14.928C42.4029 15.08 42.0109 15.156 41.5869 15.156C41.1629 15.156 40.7709 15.08 40.4109 14.928C40.0509 14.768 39.7389 14.544 39.4749 14.256C39.2189 13.968 39.0189 13.624 38.8749 13.224C38.7309 12.824 38.6589 12.376 38.6589 11.88C38.6589 11.392 38.7309 10.948 38.8749 10.548C39.0189 10.14 39.2189 9.792 39.4749 9.504C39.7389 9.216 40.0509 8.996 40.4109 8.844C40.7709 8.684 41.1629 8.604 41.5869 8.604C42.0109 8.604 42.4029 8.684 42.7629 8.844C43.1229 8.996 43.4309 9.216 43.6869 9.504C43.9509 9.792 44.1549 10.14 44.2989 10.548C44.4429 10.948 44.5149 11.392 44.5149 11.88ZM43.3509 11.88C43.3509 11.176 43.1909 10.62 42.8709 10.212C42.5589 9.796 42.1309 9.588 41.5869 9.588C41.0429 9.588 40.6109 9.796 40.2909 10.212C39.9789 10.62 39.8229 11.176 39.8229 11.88C39.8229 12.584 39.9789 13.144 40.2909 13.56C40.6109 13.968 41.0429 14.172 41.5869 14.172C42.1309 14.172 42.5589 13.968 42.8709 13.56C43.1909 13.144 43.3509 12.584 43.3509 11.88ZM51.5743 15.144C51.0703 15.144 50.6263 15.064 50.2423 14.904C49.8663 14.744 49.5463 14.52 49.2823 14.232C49.0263 13.944 48.8343 13.604 48.7063 13.212C48.5783 12.812 48.5143 12.372 48.5143 11.892C48.5143 11.412 48.5823 10.972 48.7183 10.572C48.8623 10.172 49.0623 9.828 49.3183 9.54C49.5743 9.244 49.8863 9.016 50.2543 8.856C50.6303 8.688 51.0463 8.604 51.5023 8.604C51.7823 8.604 52.0623 8.628 52.3423 8.676C52.6223 8.724 52.8903 8.8 53.1463 8.904L52.8943 9.852C52.7263 9.772 52.5303 9.708 52.3063 9.66C52.0903 9.612 51.8583 9.588 51.6103 9.588C50.9863 9.588 50.5063 9.784 50.1703 10.176C49.8423 10.568 49.6783 11.14 49.6783 11.892C49.6783 12.228 49.7143 12.536 49.7863 12.816C49.8663 13.096 49.9863 13.336 50.1463 13.536C50.3143 13.736 50.5263 13.892 50.7823 14.004C51.0383 14.108 51.3503 14.16 51.7183 14.16C52.0143 14.16 52.2823 14.132 52.5223 14.076C52.7623 14.02 52.9503 13.96 53.0863 13.896L53.2423 14.832C53.1783 14.872 53.0863 14.912 52.9663 14.952C52.8463 14.984 52.7103 15.012 52.5583 15.036C52.4063 15.068 52.2423 15.092 52.0663 15.108C51.8983 15.132 51.7343 15.144 51.5743 15.144ZM59.7961 11.88C59.7961 12.376 59.7241 12.824 59.5801 13.224C59.4361 13.624 59.2321 13.968 58.9681 14.256C58.7121 14.544 58.4041 14.768 58.0441 14.928C57.6841 15.08 57.2921 15.156 56.8681 15.156C56.4441 15.156 56.0521 15.08 55.6921 14.928C55.3321 14.768 55.0201 14.544 54.7561 14.256C54.5001 13.968 54.3001 13.624 54.1561 13.224C54.0121 12.824 53.9401 12.376 53.9401 11.88C53.9401 11.392 54.0121 10.948 54.1561 10.548C54.3001 10.14 54.5001 9.792 54.7561 9.504C55.0201 9.216 55.3321 8.996 55.6921 8.844C56.0521 8.684 56.4441 8.604 56.8681 8.604C57.2921 8.604 57.6841 8.684 58.0441 8.844C58.4041 8.996 58.7121 9.216 58.9681 9.504C59.2321 9.792 59.4361 10.14 59.5801 10.548C59.7241 10.948 59.7961 11.392 59.7961 11.88ZM58.6321 11.88C58.6321 11.176 58.4721 10.62 58.1521 10.212C57.8401 9.796 57.4121 9.588 56.8681 9.588C56.3241 9.588 55.8921 9.796 55.5721 10.212C55.2601 10.62 55.1041 11.176 55.1041 11.88C55.1041 12.584 55.2601 13.144 55.5721 13.56C55.8921 13.968 56.3241 14.172 56.8681 14.172C57.4121 14.172 57.8401 13.968 58.1521 13.56C58.4721 13.144 58.6321 12.584 58.6321 11.88ZM65.6983 11.892C65.6983 11.164 65.5183 10.604 65.1583 10.212C64.7983 9.82 64.3183 9.624 63.7183 9.624C63.3823 9.624 63.1183 9.636 62.9263 9.66C62.7423 9.684 62.5943 9.712 62.4823 9.744V13.68C62.6183 13.792 62.8143 13.9 63.0703 14.004C63.3263 14.108 63.6063 14.16 63.9103 14.16C64.2303 14.16 64.5023 14.104 64.7263 13.992C64.9583 13.872 65.1463 13.712 65.2903 13.512C65.4343 13.304 65.5383 13.064 65.6023 12.792C65.6663 12.512 65.6983 12.212 65.6983 11.892ZM66.8623 11.892C66.8623 12.364 66.7983 12.8 66.6703 13.2C66.5503 13.6 66.3703 13.944 66.1303 14.232C65.8903 14.52 65.5943 14.744 65.2423 14.904C64.8983 15.064 64.5023 15.144 64.0543 15.144C63.6943 15.144 63.3743 15.096 63.0943 15C62.8223 14.904 62.6183 14.812 62.4823 14.724V17.22H61.3663V8.952C61.6303 8.888 61.9583 8.82 62.3503 8.748C62.7503 8.668 63.2103 8.628 63.7303 8.628C64.2103 8.628 64.6423 8.704 65.0263 8.856C65.4103 9.008 65.7383 9.224 66.0103 9.504C66.2823 9.784 66.4903 10.128 66.6343 10.536C66.7863 10.936 66.8623 11.388 66.8623 11.892ZM67.5366 16.164C67.6246 16.204 67.7366 16.24 67.8726 16.272C68.0166 16.312 68.1566 16.332 68.2926 16.332C68.7326 16.332 69.0766 16.232 69.3246 16.032C69.5726 15.84 69.7966 15.524 69.9966 15.084C69.4926 14.124 69.0206 13.108 68.5806 12.036C68.1486 10.956 67.7886 9.864 67.5006 8.76H68.7006C68.7886 9.12 68.8926 9.508 69.0126 9.924C69.1406 10.34 69.2806 10.768 69.4326 11.208C69.5846 11.648 69.7486 12.088 69.9246 12.528C70.1006 12.968 70.2846 13.392 70.4766 13.8C70.7806 12.96 71.0446 12.128 71.2686 11.304C71.4926 10.48 71.7046 9.632 71.9046 8.76H73.0566C72.7686 9.936 72.4486 11.068 72.0966 12.156C71.7446 13.236 71.3646 14.248 70.9566 15.192C70.7966 15.552 70.6286 15.86 70.4526 16.116C70.2846 16.38 70.0966 16.596 69.8886 16.764C69.6806 16.932 69.4446 17.056 69.1806 17.136C68.9246 17.216 68.6326 17.256 68.3046 17.256C68.2166 17.256 68.1246 17.248 68.0286 17.232C67.9326 17.224 67.8366 17.208 67.7406 17.184C67.6526 17.168 67.5686 17.148 67.4886 17.124C67.4166 17.1 67.3646 17.08 67.3326 17.064L67.5366 16.164ZM79.1228 14.196C79.3868 14.196 79.6188 14.192 79.8188 14.184C80.0268 14.168 80.1988 14.144 80.3348 14.112V12.252C80.2548 12.212 80.1228 12.18 79.9388 12.156C79.7628 12.124 79.5468 12.108 79.2908 12.108C79.1228 12.108 78.9428 12.12 78.7508 12.144C78.5668 12.168 78.3948 12.22 78.2348 12.3C78.0828 12.372 77.9548 12.476 77.8508 12.612C77.7468 12.74 77.6948 12.912 77.6948 13.128C77.6948 13.528 77.8228 13.808 78.0788 13.968C78.3348 14.12 78.6828 14.196 79.1228 14.196ZM79.0268 8.604C79.4748 8.604 79.8508 8.664 80.1548 8.784C80.4668 8.896 80.7148 9.06 80.8988 9.276C81.0908 9.484 81.2268 9.736 81.3068 10.032C81.3868 10.32 81.4268 10.64 81.4268 10.992V14.892C81.3308 14.908 81.1948 14.932 81.0188 14.964C80.8508 14.988 80.6588 15.012 80.4428 15.036C80.2268 15.06 79.9908 15.08 79.7348 15.096C79.4868 15.12 79.2388 15.132 78.9908 15.132C78.6388 15.132 78.3148 15.096 78.0188 15.024C77.7228 14.952 77.4668 14.84 77.2508 14.688C77.0348 14.528 76.8668 14.32 76.7468 14.064C76.6268 13.808 76.5668 13.5 76.5668 13.14C76.5668 12.796 76.6348 12.5 76.7708 12.252C76.9148 12.004 77.1068 11.804 77.3468 11.652C77.5868 11.5 77.8668 11.388 78.1868 11.316C78.5068 11.244 78.8428 11.208 79.1948 11.208C79.3068 11.208 79.4228 11.216 79.5428 11.232C79.6628 11.24 79.7748 11.256 79.8788 11.28C79.9908 11.296 80.0868 11.312 80.1668 11.328C80.2468 11.344 80.3028 11.356 80.3348 11.364V11.052C80.3348 10.868 80.3148 10.688 80.2748 10.512C80.2348 10.328 80.1628 10.168 80.0588 10.032C79.9548 9.888 79.8108 9.776 79.6268 9.696C79.4508 9.608 79.2188 9.564 78.9308 9.564C78.5628 9.564 78.2388 9.592 77.9588 9.648C77.6868 9.696 77.4828 9.748 77.3468 9.804L77.2148 8.88C77.3588 8.816 77.5988 8.756 77.9348 8.7C78.2708 8.636 78.6348 8.604 79.0268 8.604ZM85.1523 15.12C84.4643 15.104 83.9763 14.956 83.6883 14.676C83.4003 14.396 83.2563 13.96 83.2563 13.368V5.88L84.3723 5.688V13.188C84.3723 13.372 84.3883 13.524 84.4203 13.644C84.4523 13.764 84.5043 13.86 84.5763 13.932C84.6483 14.004 84.7443 14.06 84.8643 14.1C84.9843 14.132 85.1323 14.16 85.3083 14.184L85.1523 15.12ZM88.4336 15.12C87.7456 15.104 87.2576 14.956 86.9696 14.676C86.6816 14.396 86.5376 13.96 86.5376 13.368V5.88L87.6536 5.688V13.188C87.6536 13.372 87.6696 13.524 87.7016 13.644C87.7336 13.764 87.7856 13.86 87.8576 13.932C87.9296 14.004 88.0256 14.06 88.1456 14.1C88.2656 14.132 88.4136 14.16 88.5896 14.184L88.4336 15.12ZM93.7362 15H92.6202V8.76H93.7362V15ZM93.1722 7.632C92.9722 7.632 92.8002 7.568 92.6562 7.44C92.5202 7.304 92.4522 7.124 92.4522 6.9C92.4522 6.676 92.5202 6.5 92.6562 6.372C92.8002 6.236 92.9722 6.168 93.1722 6.168C93.3722 6.168 93.5402 6.236 93.6762 6.372C93.8202 6.5 93.8922 6.676 93.8922 6.9C93.8922 7.124 93.8202 7.304 93.6762 7.44C93.5402 7.568 93.3722 7.632 93.1722 7.632ZM95.6553 8.94C95.9113 8.876 96.2513 8.808 96.6753 8.736C97.0993 8.664 97.5873 8.628 98.1393 8.628C98.6353 8.628 99.0473 8.7 99.3753 8.844C99.7033 8.98 99.9633 9.176 100.155 9.432C100.355 9.68 100.495 9.98 100.575 10.332C100.655 10.684 100.695 11.072 100.695 11.496V15H99.5793V11.736C99.5793 11.352 99.5513 11.024 99.4953 10.752C99.4473 10.48 99.3633 10.26 99.2433 10.092C99.1233 9.924 98.9633 9.804 98.7633 9.732C98.5633 9.652 98.3153 9.612 98.0193 9.612C97.8993 9.612 97.7753 9.616 97.6473 9.624C97.5193 9.632 97.3953 9.644 97.2753 9.66C97.1633 9.668 97.0593 9.68 96.9633 9.696C96.8753 9.712 96.8113 9.724 96.7713 9.732V15H95.6553V8.94ZM104.982 5.688C105.31 5.688 105.59 5.712 105.822 5.76C106.062 5.808 106.23 5.852 106.326 5.892L106.122 6.852C106.026 6.804 105.89 6.76 105.714 6.72C105.538 6.672 105.322 6.648 105.066 6.648C104.546 6.648 104.182 6.792 103.974 7.08C103.766 7.36 103.662 7.74 103.662 8.22V8.76H106.062V9.696H103.662V15H102.546V8.196C102.546 7.396 102.742 6.78 103.134 6.348C103.526 5.908 104.142 5.688 104.982 5.688ZM112.683 11.88C112.683 12.376 112.611 12.824 112.467 13.224C112.323 13.624 112.119 13.968 111.855 14.256C111.599 14.544 111.291 14.768 110.931 14.928C110.571 15.08 110.179 15.156 109.755 15.156C109.331 15.156 108.939 15.08 108.579 14.928C108.219 14.768 107.907 14.544 107.643 14.256C107.387 13.968 107.187 13.624 107.043 13.224C106.899 12.824 106.827 12.376 106.827 11.88C106.827 11.392 106.899 10.948 107.043 10.548C107.187 10.14 107.387 9.792 107.643 9.504C107.907 9.216 108.219 8.996 108.579 8.844C108.939 8.684 109.331 8.604 109.755 8.604C110.179 8.604 110.571 8.684 110.931 8.844C111.291 8.996 111.599 9.216 111.855 9.504C112.119 9.792 112.323 10.14 112.467 10.548C112.611 10.948 112.683 11.392 112.683 11.88ZM111.519 11.88C111.519 11.176 111.359 10.62 111.039 10.212C110.727 9.796 110.299 9.588 109.755 9.588C109.211 9.588 108.779 9.796 108.459 10.212C108.147 10.62 107.991 11.176 107.991 11.88C107.991 12.584 108.147 13.144 108.459 13.56C108.779 13.968 109.211 14.172 109.755 14.172C110.299 14.172 110.727 13.968 111.039 13.56C111.359 13.144 111.519 12.584 111.519 11.88ZM116.557 8.628C116.653 8.628 116.761 8.636 116.881 8.652C117.009 8.66 117.133 8.676 117.253 8.7C117.373 8.716 117.481 8.736 117.577 8.76C117.681 8.776 117.757 8.792 117.805 8.808L117.613 9.78C117.525 9.748 117.377 9.712 117.169 9.672C116.969 9.624 116.709 9.6 116.389 9.6C116.181 9.6 115.973 9.624 115.765 9.672C115.565 9.712 115.433 9.74 115.369 9.756V15H114.253V9.024C114.517 8.928 114.845 8.84 115.237 8.76C115.629 8.672 116.069 8.628 116.557 8.628ZM118.882 8.94C119.138 8.876 119.474 8.808 119.89 8.736C120.314 8.664 120.802 8.628 121.354 8.628C121.754 8.628 122.09 8.684 122.362 8.796C122.634 8.9 122.862 9.056 123.046 9.264C123.102 9.224 123.19 9.168 123.31 9.096C123.43 9.024 123.578 8.956 123.754 8.892C123.93 8.82 124.126 8.76 124.342 8.712C124.558 8.656 124.79 8.628 125.038 8.628C125.518 8.628 125.91 8.7 126.214 8.844C126.518 8.98 126.754 9.176 126.922 9.432C127.098 9.688 127.214 9.992 127.27 10.344C127.334 10.696 127.366 11.08 127.366 11.496V15H126.25V11.736C126.25 11.368 126.23 11.052 126.19 10.788C126.158 10.524 126.09 10.304 125.986 10.128C125.89 9.952 125.754 9.824 125.578 9.744C125.41 9.656 125.19 9.612 124.918 9.612C124.542 9.612 124.23 9.664 123.982 9.768C123.742 9.864 123.578 9.952 123.49 10.032C123.554 10.24 123.602 10.468 123.634 10.716C123.666 10.964 123.682 11.224 123.682 11.496V15H122.566V11.736C122.566 11.368 122.546 11.052 122.506 10.788C122.466 10.524 122.394 10.304 122.29 10.128C122.194 9.952 122.058 9.824 121.882 9.744C121.714 9.656 121.498 9.612 121.234 9.612C121.122 9.612 121.002 9.616 120.874 9.624C120.746 9.632 120.622 9.644 120.502 9.66C120.39 9.668 120.286 9.68 120.19 9.696C120.094 9.712 120.03 9.724 119.998 9.732V15H118.882V8.94ZM131.33 14.196C131.594 14.196 131.826 14.192 132.026 14.184C132.234 14.168 132.406 14.144 132.542 14.112V12.252C132.462 12.212 132.33 12.18 132.146 12.156C131.97 12.124 131.754 12.108 131.498 12.108C131.33 12.108 131.15 12.12 130.958 12.144C130.774 12.168 130.602 12.22 130.442 12.3C130.29 12.372 130.162 12.476 130.058 12.612C129.954 12.74 129.902 12.912 129.902 13.128C129.902 13.528 130.03 13.808 130.286 13.968C130.542 14.12 130.89 14.196 131.33 14.196ZM131.234 8.604C131.682 8.604 132.058 8.664 132.362 8.784C132.674 8.896 132.922 9.06 133.106 9.276C133.298 9.484 133.434 9.736 133.514 10.032C133.594 10.32 133.634 10.64 133.634 10.992V14.892C133.538 14.908 133.402 14.932 133.226 14.964C133.058 14.988 132.866 15.012 132.65 15.036C132.434 15.06 132.198 15.08 131.942 15.096C131.694 15.12 131.446 15.132 131.198 15.132C130.846 15.132 130.522 15.096 130.226 15.024C129.93 14.952 129.674 14.84 129.458 14.688C129.242 14.528 129.074 14.32 128.954 14.064C128.834 13.808 128.774 13.5 128.774 13.14C128.774 12.796 128.842 12.5 128.978 12.252C129.122 12.004 129.314 11.804 129.554 11.652C129.794 11.5 130.074 11.388 130.394 11.316C130.714 11.244 131.05 11.208 131.402 11.208C131.514 11.208 131.63 11.216 131.75 11.232C131.87 11.24 131.982 11.256 132.086 11.28C132.198 11.296 132.294 11.312 132.374 11.328C132.454 11.344 132.51 11.356 132.542 11.364V11.052C132.542 10.868 132.522 10.688 132.482 10.512C132.442 10.328 132.37 10.168 132.266 10.032C132.162 9.888 132.018 9.776 131.834 9.696C131.658 9.608 131.426 9.564 131.138 9.564C130.77 9.564 130.446 9.592 130.166 9.648C129.894 9.696 129.69 9.748 129.554 9.804L129.422 8.88C129.566 8.816 129.806 8.756 130.142 8.7C130.478 8.636 130.842 8.604 131.234 8.604ZM136.531 8.76H138.895V9.696H136.531V12.576C136.531 12.888 136.555 13.148 136.603 13.356C136.651 13.556 136.723 13.716 136.819 13.836C136.915 13.948 137.035 14.028 137.179 14.076C137.323 14.124 137.491 14.148 137.683 14.148C138.019 14.148 138.287 14.112 138.487 14.04C138.695 13.96 138.839 13.904 138.919 13.872L139.135 14.796C139.023 14.852 138.827 14.92 138.547 15C138.267 15.088 137.947 15.132 137.587 15.132C137.163 15.132 136.811 15.08 136.531 14.976C136.259 14.864 136.039 14.7 135.871 14.484C135.703 14.268 135.583 14.004 135.511 13.692C135.447 13.372 135.415 13.004 135.415 12.588V7.02L136.531 6.828V8.76ZM141.431 15H140.315V8.76H141.431V15ZM140.867 7.632C140.667 7.632 140.495 7.568 140.351 7.44C140.215 7.304 140.147 7.124 140.147 6.9C140.147 6.676 140.215 6.5 140.351 6.372C140.495 6.236 140.667 6.168 140.867 6.168C141.067 6.168 141.235 6.236 141.371 6.372C141.515 6.5 141.587 6.676 141.587 6.9C141.587 7.124 141.515 7.304 141.371 7.44C141.235 7.568 141.067 7.632 140.867 7.632ZM148.859 11.88C148.859 12.376 148.787 12.824 148.643 13.224C148.499 13.624 148.295 13.968 148.031 14.256C147.775 14.544 147.467 14.768 147.107 14.928C146.747 15.08 146.355 15.156 145.931 15.156C145.507 15.156 145.115 15.08 144.755 14.928C144.395 14.768 144.083 14.544 143.819 14.256C143.563 13.968 143.363 13.624 143.219 13.224C143.075 12.824 143.003 12.376 143.003 11.88C143.003 11.392 143.075 10.948 143.219 10.548C143.363 10.14 143.563 9.792 143.819 9.504C144.083 9.216 144.395 8.996 144.755 8.844C145.115 8.684 145.507 8.604 145.931 8.604C146.355 8.604 146.747 8.684 147.107 8.844C147.467 8.996 147.775 9.216 148.031 9.504C148.295 9.792 148.499 10.14 148.643 10.548C148.787 10.948 148.859 11.392 148.859 11.88ZM147.695 11.88C147.695 11.176 147.535 10.62 147.215 10.212C146.903 9.796 146.475 9.588 145.931 9.588C145.387 9.588 144.955 9.796 144.635 10.212C144.323 10.62 144.167 11.176 144.167 11.88C144.167 12.584 144.323 13.144 144.635 13.56C144.955 13.968 145.387 14.172 145.931 14.172C146.475 14.172 146.903 13.968 147.215 13.56C147.535 13.144 147.695 12.584 147.695 11.88ZM150.429 8.94C150.685 8.876 151.025 8.808 151.449 8.736C151.873 8.664 152.361 8.628 152.913 8.628C153.409 8.628 153.821 8.7 154.149 8.844C154.477 8.98 154.737 9.176 154.929 9.432C155.129 9.68 155.269 9.98 155.349 10.332C155.429 10.684 155.469 11.072 155.469 11.496V15H154.353V11.736C154.353 11.352 154.325 11.024 154.269 10.752C154.221 10.48 154.137 10.26 154.017 10.092C153.897 9.924 153.737 9.804 153.537 9.732C153.337 9.652 153.089 9.612 152.793 9.612C152.673 9.612 152.549 9.616 152.421 9.624C152.293 9.632 152.169 9.644 152.049 9.66C151.937 9.668 151.833 9.68 151.737 9.696C151.649 9.712 151.585 9.724 151.545 9.732V15H150.429V8.94Z" fill="white"/>
                        </svg>
                    </div>
                    <button class="btns btn actionbtn btn-primary rounded shadow rightPanelIcons  copytextIcon"
                            onclick="copyAllTexts();" >
                    </button>
                </div>
                </div>

            @else
            <div class="position-relative col-12">
                <div class="  align-items-center row " data-margin="0" data-dots="false" data-browse="true"
                     data-autoplay="false" data-autoplay-timeout="5000"
                     data-responsive='{"0":{"items": "4"}, "768":{"items": "9"}, "992":{"items": "9"}, "1400":{"items": "9"}}'>

                    <div class="d-flex  align-items-center justify-content-start  align-content-center col-lg-10 col-md-12">
                        <div class="item">
                            <div class="item-inner  p-3">
                                <button class="btns actionbtn btn-primary rounded shadow rightPanelIcons  navigationIcon"
                                        onclick="resetView();" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        title="Normal view">
                                </button>


                            </div>

                        </div>

                        <div class="item">
                            <div class="item-inner  p-3">
                                <button class="btns actionbtn btn-primary rounded shadow rightPanelIcons  addannotationIcon"
                                        onclick="addAnnotations();" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        title="Add modification requests"></button>

                            </div>

                        </div>



                        <div class="item">
                            <div class="item-inner  pl-3">


                                <div class="btn-group">
                                    <button id="changeDrawType" onclick="drawonPhoto();" type="button"
                                            class="actionbtn btn-icon btn-primary splitbtno annotationBtnDark  overflow-hidden">
                                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17.2518 3.46669L13.9248 0.139629C13.7385 -0.046543 13.4366 -0.046543 13.2503 0.139629L4.97763 8.41227C4.91093 8.47903 4.86547 8.5641 4.84709 8.65662L4.0228 12.808C3.99183 12.9641 4.04073 13.1255 4.15333 13.2381C4.24369 13.3284 4.36532 13.3777 4.49058 13.3777C4.52142 13.3777 4.55257 13.3748 4.58348 13.3686L8.73483 12.5443C8.82741 12.5259 8.91242 12.4805 8.97918 12.4138L17.2518 4.14112C17.4381 3.95488 17.4381 3.65299 17.2518 3.46669ZM5.2897 11.3251L5.72054 9.15518L8.23628 11.6709L6.06637 12.1018L5.2897 11.3251Z" fill="white"/>
                                            <path d="M13.0927 14.4376C8.53194 12.5283 5.56286 15.686 4.67612 16.1655C3.54262 16.7785 1.94579 17.4988 1.57459 16.2519C1.35065 15.4995 2.56147 14.6954 3.36325 14.4448C3.94822 14.2619 3.6984 13.3411 3.10968 13.5251C1.86459 13.9143 0.378903 14.9631 0.639404 16.4397C0.832951 17.5369 2.20801 18.5376 4.8593 17.1463C6.78639 16.1352 8.09551 14.0409 12.1544 15.1255C13.4877 15.4817 14.5655 16.3507 15.027 17.6724C15.2284 18.2491 16.15 18.0011 15.9467 17.4189C15.4548 16.0102 14.4597 15.0099 13.0927 14.4376Z" fill="white"/>
                                        </svg>
                                    </button>
                                    <button id="changeDrawTypeAction" type="button"
                                            class=" actionbtn btn-icon btn-primary splitbtn annotationBtnDark dropdown-toggle dropdown-toggle-split"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                            title="Select a drawing tool">
                                        <span class="sr-only"><i class="uil uil-angle-down"></i></span>
                                    </button>
                                    <div class="dropdown-menu">

                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="item">
                            <div class="item-inner  p-0">
                                <input type="text" value="#000000"
                                       id="line-color-input" class=" rounded" data-bs-toggle="tooltip"
                                       data-bs-placement="bottom"
                                       title="Change color" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                       title="Change drawing color">

                            </div>

                        </div>

                   <div class="item">
                            <div class="item-inner  p-0 d-flex">
                                <input class="actionbtn  px-2 p-0 w-100" type="range" min="2" max="11"
                                       value="2"
                                       id="line-size-input" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                       title="Change stroke width">

                                <span id="strokeWidth" class="text-primary p-1 w-5">2</span>

                            </div>

                        </div>

                        <div class="item">
                            <div class="item-inner  p-1">

                                <button class=" annotationBtn undoIcon actionbtn" id="undo" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        title="Undo"></button>
                            </div>

                        </div>

                        <div class="item">
                            <div class="item-inner  p-1">
                                <button class="annotationBtn redoIcon actionbtn" id="redo" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        title="Redo"></button>

                            </div>

                        </div>

                        <div class="item">
                            <div class="item-inner  p-1">
                                <button class=" annotationBtn clearIcon actionbtn px-5" id="clear" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        title="Delete drawing"></button>

                            </div>

                        </div>

                        <div class="item">
                            <div class="item-inner p-3">
                                <button class="btns btn-primary rounded shadow actionbtn rightPanelIcons unhideIcon"
                                        id="hideBtn"
                                        onclick="hideElements();" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        title="Hide Elements">
                                </button>

                            </div>

                        </div>

                        <div class="item">
                            <button class="btns btn-primary rounded shadow actionbtn rightPanelIcons"
                                    id="beforeAfterBtn"
                                    onclick="toogleBeforeAfterMode();" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                    title="Before / After">
                                    B / A
                            </button>
                        </div>
                    </div>
                    <div id="drawingstatus" class="d-flex  align-items-center justify-content-center  align-content-center col-lg-2 col-md-12">

                    </div>



                </div>
                <!-- /.owl-carousel -->
            </div>
        @endif
        </div>


    </div>
    <!-- /.container -->
</section>
<div class="row w-100 "
     id="toolBox">


</div>
<section class="section">
   <div class="container px-10 pb-10 m-0  text-center" align="center" style="max-width: 100%; ">
        <div id="AnnotationsArea" class="w-100">
            <div class="w-100" id="img-container">
                <p class="position-absolute p-4 hoverDisabled" style="top:16px;"
                   id="mouseCoord"></p>
                <p class="position-absolute p-4 text-primary d-none hoverDisabled" id="escmode"></p>

                <div id="zoomArea" style=" text-align: center; display: flex; justify-content: center; align-items: center" >
                    <div
                            onmouseout="clearCoords()" id="sketchpad" class="position-absolute"
                    ></div>
                    <div class="position-absolute" id="annotations-container"
                         style="height:100%; width:100%">
                        <div class="position-absolute annotationsF d-none"
                             id="annotationFollower"></div>
                    </div>
                    <img id="annotations-img"
                         src="{{url('uploads/proofs/'.$proof->filePath)}}"
                         class="rounded shadow  d-block h-100" loading="lazy">
                </div>

                <!-- Before / After -->
                <div class="custom-image-slider d-none" id="customImageSlider">
                    <img
                        id="customImageSlider-before"
                        class="slider-before rounded shadow d-block" 
                        src="@if($proof->before_upload) {{url('uploads/proofs/'.$proof->before_upload->filePath)}} @endif"
                        loading="lazy"
                        alt="Before"
                    />
                    <img
                        id="customImageSlider-after"
                        class="slider-after rounded shadow d-block"
                        src="{{url('uploads/proofs/'.$proof->filePath)}}"
                        loading="lazy"
                        alt="After"
                    />
                    <div class="slider-handle"></div>
                </div>
            </div>
            <div class="modal fade" id="projetModalInfo" tabindex="-1" aria-labelledby="" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header p-3">
                            <h5 class="modal-title">Project info</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4"> 
                            <p class="mb-1 fs-lg"> 
                                <span id="info-project-id" class="text-primary fw-bold"></span>
                                <span id="info-project-name" class="text-dark fw-normal"></span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>            
            @include('layouts.default.template.annotationmodal')

        </div>
    </div>
</section>

<div id="listContent" style="display:none;">
    <ul class="list-group list-unstyled p-5 cursor-pointer">
        <li class="list-group-item activeElement" onclick="changeDrawType('hand',this);"><span><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path class="path" d="M17.2518 3.46669L13.9248 0.139629C13.7385 -0.046543 13.4366 -0.046543 13.2503 0.139629L4.97763 8.41227C4.91093 8.47903 4.86547 8.5641 4.84709 8.65662L4.0228 12.808C3.99183 12.9641 4.04073 13.1255 4.15333 13.2381C4.24369 13.3284 4.36532 13.3777 4.49058 13.3777C4.52142 13.3777 4.55257 13.3748 4.58348 13.3686L8.73483 12.5443C8.82741 12.5259 8.91242 12.4805 8.97918 12.4138L17.2518 4.14112C17.4381 3.95488 17.4381 3.65299 17.2518 3.46669ZM5.2897 11.3251L5.72054 9.15518L8.23628 11.6709L6.06637 12.1018L5.2897 11.3251Z" />
<path class="path"  d="M13.0927 14.4376C8.53194 12.5283 5.56286 15.686 4.67612 16.1655C3.54262 16.7785 1.94579 17.4988 1.57459 16.2519C1.35065 15.4995 2.56147 14.6954 3.36325 14.4448C3.94822 14.2619 3.6984 13.3411 3.10968 13.5251C1.86459 13.9143 0.378903 14.9631 0.639404 16.4397C0.832951 17.5369 2.20801 18.5376 4.8593 17.1463C6.78639 16.1352 8.09551 14.0409 12.1544 15.1255C13.4877 15.4817 14.5655 16.3507 15.027 17.6724C15.2284 18.2491 16.15 18.0011 15.9467 17.4189C15.4548 16.0102 14.4597 15.0099 13.0927 14.4376Z" />
</svg>
</span>
            Free Hand
        </li>
        <li class="list-group-item" onclick="changeDrawType('line',this);"><span>
                <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
<path class="path" d="M17.8574 0H15.6308C15.3231 0 15.0742 0.248967 15.0742 0.556641V2.55272L8.55756 9.06933L2.62694 14.7129H0.556641C0.248967 14.7129 0 14.9618 0 15.2695V17.5703C0 17.878 0.248967 18.1269 0.556641 18.1269H2.85742C3.1651 18.1269 3.41406 17.878 3.41406 17.5703V15.5L15.8613 3.33984H17.8574C18.165 3.33984 18.414 3.09088 18.414 2.7832V0.556641C18.414 0.248967 18.165 0 17.8574 0Z" />
</svg>

            </span>
            Line
        </li>
        <li class="list-group-item" onclick="changeDrawType('arrow',this);"><span>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path class="path" d="M12.8664 0.429939C12.8661 0.42994 12.8658 0.42989 12.8655 0.429915L7.68225 0.442449C7.29395 0.443395 6.97988 0.758907 6.9808 1.14728C6.98172 1.53561 7.29726 1.84965 7.68558 1.84873L11.1656 1.84028L0.636247 12.3696C0.361652 12.6442 0.361652 13.0894 0.636246 13.364C0.910841 13.6386 1.35602 13.6386 1.63061 13.364L12.1599 2.83467L12.1515 6.31461C12.1506 6.70293 12.4646 7.01847 12.853 7.01939C13.2414 7.02034 13.5568 6.70619 13.5578 6.31794L13.5703 1.1347C13.5703 1.1344 13.5703 1.1341 13.5703 1.13378C13.5707 0.744706 13.2542 0.429517 12.8664 0.429939Z" />
</svg>

            </span>
            Arrow
        </li>
        <li class="list-group-item" onclick="changeDrawType('rectangle',this);"><span><svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path class="path" d="M17.5 3.68583C17.7761 3.68583 18 3.46197 18 3.18583V0.710388C18 0.434246 17.7761 0.210388 17.5 0.210388H15.0246C14.7484 0.210388 14.5246 0.434246 14.5246 0.710388V1.42075H3.47544V0.710388C3.47544 0.434246 3.25158 0.210388 2.97544 0.210388H0.5C0.223858 0.210388 0 0.434246 0 0.710388V3.18583C0 3.46197 0.223858 3.68583 0.5 3.68583H1.21039V12.3142H0.5C0.223858 12.3142 0 12.5381 0 12.8142V15.2896C0 15.5658 0.223858 15.7896 0.5 15.7896H2.97544C3.25158 15.7896 3.47544 15.5658 3.47544 15.2896V14.5793H14.5246V15.2896C14.5246 15.5658 14.7484 15.7896 15.0246 15.7896H17.5C17.7761 15.7896 18 15.5658 18 15.2896V12.8142C18 12.5381 17.7761 12.3142 17.5 12.3142H16.7896V3.68583H17.5ZM15.7349 12.3142H15.0246C14.7484 12.3142 14.5246 12.538 14.5246 12.8142V13.5246H3.47544V12.8142C3.47544 12.538 3.25158 12.3142 2.97544 12.3142H2.26508V3.68583H2.97544C3.25158 3.68583 3.47544 3.46197 3.47544 3.18583V2.47544H14.5246V3.18583C14.5246 3.46197 14.7484 3.68583 15.0246 3.68583H15.7349V12.3142Z" />
</svg></span>
            Rectangle
        </li>
        <li class="list-group-item " onclick="changeDrawType('circle',this);"><span>
<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path class="path" d="M18 7.91176C18 7.63562 17.7761 7.41177 17.5 7.41177H16.7817C16.4732 5.88459 15.73 4.50014 14.6149 3.38509C13.4998 2.27001 12.1154 1.52675 10.5882 1.21828V0.5C10.5882 0.223858 10.3644 0 10.0882 0H7.91177C7.63562 0 7.41177 0.223858 7.41177 0.5V1.21828C5.88459 1.52675 4.50018 2.27001 3.38509 3.38509C2.27001 4.50018 1.52675 5.88459 1.21828 7.41177H0.5C0.223858 7.41177 0 7.63562 0 7.91177V10.0882C0 10.3644 0.223858 10.5882 0.5 10.5882H1.21828C1.52675 12.1154 2.27005 13.4998 3.38513 14.6149C4.50018 15.73 5.88459 16.4732 7.4118 16.7817V17.5C7.4118 17.7761 7.63566 18 7.9118 18H10.0883C10.3644 18 10.5883 17.7761 10.5883 17.5V16.7817C12.1155 16.4732 13.4999 15.73 14.6149 14.6149C15.73 13.4998 16.4732 12.1154 16.7818 10.5882H17.5C17.7761 10.5882 18 10.3643 18 10.0882V7.91176ZM10.5882 15.6971V15.3235C10.5882 15.0474 10.3644 14.8235 10.0882 14.8235H7.91177C7.63562 14.8235 7.41177 15.0474 7.41177 15.3235V15.6971C4.89526 15.1001 2.89991 13.1047 2.30294 10.5882H2.67647C2.95261 10.5882 3.17647 10.3644 3.17647 10.0882V7.91177C3.17647 7.63562 2.95261 7.41177 2.67647 7.41177H2.30294C2.89991 4.89526 4.89526 2.89991 7.41177 2.30294V2.67647C7.41177 2.95261 7.63562 3.17647 7.91177 3.17647H10.0882C10.3644 3.17647 10.5882 2.95261 10.5882 2.67647V2.30291C13.1047 2.89991 15.1001 4.89526 15.6971 7.41177H15.3235C15.0474 7.41177 14.8235 7.63562 14.8235 7.91177V10.0882C14.8235 10.3644 15.0474 10.5882 15.3235 10.5882H15.6971C15.1001 13.1047 13.1047 15.1001 10.5882 15.6971Z" />
</svg>


            </span>
            Circle
        </li>

    </ul>
</div>

<div id="messagesContent" style="display:none;">

</div>


@section('scripts')
    <script src='{{asset('theme/annotations/underscore-min.js')}}' type='text/javascript'></script>
    <script src='{{asset('theme/annotations/imageeditor/scripts.min.js')}}' type='text/javascript'></script>
    <script src='{{asset('theme/annotations/lib/jquery.events.input.js')}}' type='text/javascript'></script>
    <script src='{{asset('theme/annotations/lib/jquery.elastic.js')}}' type='text/javascript'></script>
    <script src='{{asset('theme/annotations/jquery.mentionsInput.js')}}' type='text/javascript'></script>
    <script src='{{asset('theme/annotations/js/js-image-zoom.js')}}' type='text/javascript'></script>

    <script src="{{asset('theme/annotations/js/undomanager.js')}}"></script>
    <script src="{{asset('theme/annotations/js/jquery.emojiFace.js')}}"></script>
    <script src="{{asset('theme/annotations/js/sketchpad.js')}}"></script>
    <script src="{{asset('theme/annotations/js/spectrum.min.js')}}"></script>
    <script src="{{asset('theme/annotations/js/timeago.min.js')}}"></script>
    <script src="{{asset('theme/annotations/js/panzoom.js')}}"></script>

    <script>
        var initialPercentage = 50;
        var dragging = false;
        var lastX = 0;

        var resetBeforeAfterSlider = () => {
            // console.log("reset slider ...")
            const afterImage = document.querySelector(".slider-after");
            const handle = document.querySelector(".slider-handle");
            handle.style.left = `${initialPercentage}%`;
            afterImage.style.clipPath = `inset(0 ${100 - initialPercentage}% 0 0)`;
            dragging = false
            lastX = 0
        }

        document.addEventListener("DOMContentLoaded", function () {
            const container = document.querySelector(".custom-image-slider");
            const afterImage = document.querySelector(".slider-after");
            const handle = document.querySelector(".slider-handle");

            // Set initial handle position and clipPath
            resetBeforeAfterSlider()

            // Add mouse event listeners
            handle.addEventListener("mousedown", (e) => {
                dragging = true;
                lastX = e.clientX;
                e.preventDefault();
            });
            document.addEventListener("mouseup", () => {
                dragging = false;
            });
            document.addEventListener("mouseleave", () => {
                dragging = false;
            });

            document.addEventListener("mousemove", (e) => {
                if (!dragging) return;
                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left;
                
                let widthPercentage = (x / rect.width) * 100;
                // Add constraint to keep the handle within 1% of either edge
                widthPercentage = Math.max(0, Math.min(widthPercentage, 100));
                // Update handle position using requestAnimationFrame

                // todo clean
                // if(widthPercentage >=1 && widthPercentage <= 99){ // }
                window.requestAnimationFrame(() => {
                    handle.style.left = `${widthPercentage}%`;
                    afterImage.style.clipPath = `inset(0 ${100 - widthPercentage}% 0 0)`;
                });
                lastX = x;
               
            });

            // Add touch event listeners
            handle.addEventListener("touchstart", (e) => {
                dragging = true;
                lastX = e.touches[0].clientX;
                e.preventDefault();
            });
            document.addEventListener("touchend", () => {
                dragging = false;
            });
            container.addEventListener("touchcancel", () => {
                dragging = false;
            });

            // mobile case 
            container.addEventListener("touchmove", (e) => {
                if (!dragging) return;
                const rect = container.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                let widthPercentage = (x / rect.width) * 100;
                // Add constraint to keep the handle within 1% of either edge
                widthPercentage = Math.max(0, Math.min(widthPercentage, 100));
                // Update handle position using requestAnimationFrame
                window.requestAnimationFrame(() => {
                handle.style.left = `${widthPercentage}%`;
                afterImage.style.clipPath = `inset(0 ${100 - widthPercentage}% 0 0)`;
                });
                lastX = x;
            });
            });
    </script>

    <script>
        var drawType = "hand";
        var isClearing = false;
        var isHidden = false;
        var isBeforeAfterMode = false;
        var isAnnotationDisplayed = false;

        var dataId = 0;
        var dataUnique = "";
        var lastId = 0;
        var sessionData = {!! json_encode($sessionUpload) !!};
        var proofBeforeUploadFile =  {!! json_encode($proof->before_upload) !!};
        var proofUploadFile =  {!! json_encode($proof) !!};
        var projectData =  {!! json_encode($project) !!};
        var currentJsonId = null;

        @if(isset($proof->id))
        var currentProof = '{{$proof->id}}';
        @else
        var currentProof = '';
        @endif
        //colors

        function toogleBeforeAfterMode() {
            WebuiPopovers.hideAll();
            if(isBeforeAfterMode){
                $('#zoomArea').removeClass('d-none');
                $('#customImageSlider').addClass('d-none');
                $('#beforeAfterBtn').removeClass('activeDraw');
                isBeforeAfterMode = false;
            }else{
                resetBeforeAfterSlider(); // Set initial handle position and clipPath
                $('#zoomArea').addClass('d-none');
                $('#customImageSlider').removeClass('d-none');
                $('#beforeAfterBtn').addClass('activeDraw');
                isBeforeAfterMode = true;
            }
        }

        function showProjectInfo(){
            $("#projetModalInfo").modal('show')
        }

        // disable before upload file when is empty
        document.addEventListener("DOMContentLoaded", function () {
            // set slider container height on page loaded
            const sliderHeight = 'Calc('+$(window).height()+'px - '+$('#topContent').height()+'px)'
            $('#customImageSlider').css('height', sliderHeight);
            $('.slider-before').css('height', sliderHeight);
            $('.slider-after').css('height', sliderHeight);

            if(!proofBeforeUploadFile){
                $("#beforeAfterBtn").css("display", "none")
            }

            if(projectData){
                // file upload info
                $("#info-project-id").text(projectData?.project_ref)
                $("#info-project-name").text(projectData?.project_name ? ` - ${projectData?.project_name} ` : "")
            }else{
                // hide button info
                $("#projetModalInfoBtn").css("display", "none")
            }         
        })

        if (localStorage.getItem('selectedColor') != null) {
            $('#line-color-input').val(localStorage.getItem('selectedColor'));

        }
        $('#line-color-input').spectrum({
            type: "color",
            showPaletteOnly: true,
            togglePaletteOnly: true,
            hideAfterPaletteSelect: true,
            cancelText: "Cancel",
            chooseText: "Validate",
            togglePaletteMoreText: "More",
            togglePaletteLessText: "Less",

            showInput: true,
            showInitial: true,
            showAlpha: false,
            showButtons: true,
            allowEmpty: false
        });

        //popover

        var settings = {
            trigger: 'click',

            title: ' ',
            content: ' ',
            width:360,
            multiple: true,
            closeable: true,
            dismissible: true,
            style: '',
            padding: true
        };

        var listContent = $('#listContent').html(),
            listSettings = {
                content: listContent,
                title: '',
                width: 185,
                minWidth:180,
                padding: false
            };

        //getProof
        function getProof(id, imgid, url) {
            WebuiPopovers.hideAll();
            currentProof = id;
            isAnnotationDisplayed=false;
            lastId=0;
            $('.imgslist').removeClass('activeThumb');
            $('#' + imgid).addClass('activeThumb');
            $('#annotations-img').attr('src', url);

            // close before/after mode
            $('#zoomArea').removeClass('d-none');
            $('#customImageSlider').addClass('d-none');
            $('#beforeAfterBtn').removeClass('activeDraw');
            isBeforeAfterMode = false;
            
            // disable before upload file when is empty
            const selectedProof = sessionData.find(item => item.id == currentProof)
            if(!selectedProof?.before_upload){
                $("#beforeAfterBtn").css("display", "none")
            }else{
                const beforeImgUrl = "{{url('uploads/proofs/')}}" + `/${selectedProof.before_upload.filePath}`
                $('#customImageSlider-before').attr('src', beforeImgUrl);
                $('#customImageSlider-after').attr('src', url);
                $("#beforeAfterBtn").css("display", "block")
            }

            // file upload info // todo clean
            // $("#info-file-name").text(selectedProof.oldname)
            // $("#info-created-at").text(selectedProof.created_at)  

            loadData();

        }

        $('#changeDrawTypeAction').webuiPopover('destroy').webuiPopover($.extend({}, settings, listSettings));

        $("#line-size-input").on("input change", function () {
            $('#strokeWidth').html(this.value);
        });
        var el = document.getElementById('sketchpad');
        var pad = new Sketchpad(el);

 @if(!$isSubmited)
        // setLineColor
        function setLineColor(e) {
            var color = e.target.value;
            if (!color.startsWith('#')) {
                color = '#' + color;
            }

            localStorage.setItem('selectedColor', color);
            pad.setLineColor(color);
        }


        document.getElementById('line-color-input').oninput = setLineColor;
        document.getElementById('line-color-input').onchange = setLineColor;

        // setLineSize
        function setLineSize(e) {
            var size = e.target.value;
            pad.setLineSize(size);
        }

        document.getElementById('line-size-input').oninput = setLineSize;

        // undo
        function undo() {
            WebuiPopovers.hideAll();
            pad.undo();
            if (isHidden) {
                hideElements();
            }
            saveJson();
        }

        document.getElementById('undo').onclick = undo;

        // redo
        function redo() {
            WebuiPopovers.hideAll();
            pad.redo();
            if (isHidden) {
                hideElements();
            }
            saveJson();
        }

        document.getElementById('redo').onclick = redo;

        // clear
        function clear() {
            WebuiPopovers.hideAll();
            if (pad.getReadOnly()) {
                drawonPhoto();
            }
            if (isClearing) {
                pad.setDrawType(drawType);
                isClearing = false;
                $('#clear').removeClass('AclearIcon').addClass('clearIcon');
                $('#changeDrawType').addClass('activeDraw');
                $('#changeDrawTypeAction').addClass('activeDraw');
            } else {
                pad.setDrawType('delete');
                if (isHidden) {
                    hideElements();
                }

                isClearing = true;
                $('#clear').removeClass('clearIcon').addClass('AclearIcon');
                $('#changeDrawType').removeClass('activeDraw');
                $('#changeDrawTypeAction').removeClass('activeDraw');
            }


            saveJson();
        }

        document.getElementById('clear').onclick = clear;


        function closeDrawing() {

            if (is_zoom_selected) {
                is_zoom_selected = false;

                $('.img-magnifier-glass').remove();


                // $('#annotations-container').removeClass('hoverDisabled');
            }

            if (is_annotations_active) {

                is_annotations_active = false;


            }
            $('#annotations-container').removeClass('hoverDisabled');

            if (is_chat_visible) showSidebar();

            if (!$('#fullscreenmode').hasClass('fullscreen')) {

                $('#fullscreenmode').addClass('fullscreen');
                $('#fullscreenmode').html('<i class="mdi mdi-fullscreen"></i>');

            }

            $('#toolBox').removeClass('d-none').addClass('d-none');
            $('#escmode').addClass('d-none');

        }

        //document.getElementById('closeDrawing').onclick = closeDrawing;


        function changeJson(e, a) {
            const files = e.target.files;
            if (files.length == 0) return;

            const reader = new FileReader();
            reader.addEventListener('load', (event) => {
                try {
                    var data = JSON.parse(event.target.result);
                } catch (e) {
                    alert("Unable to read JSON file");
                    throw e;
                }
                pad.loadJSON(data);
            });
            reader.readAsText(files[0]);
        }

        //document.getElementById('uploadJsonInput').addEventListener('change', changeJson, false);


        function saveJson() {

            showSavingStatus('saving', "drawingstatus");
            var data = JSON.stringify(pad.toJSON());
            var datas = {
                'session_upload_id': currentProof,
                'sessionId': '{{$sessionId}}',
                'content': data,
                'id': currentJsonId
            };
            ApiGetData('{{url('account/drawing/')}}', 'PUT', datas).then(function (e) {
                if (e.status == 1) {
                    sessionData = e.data;
                    if (e.currentJson != '') {
                        currentJsonId = e.currentJson.id;
                    }
                    showSavingStatus('saved', "drawingstatus");
                    //TODO: load data
                } else {
                    showSavingStatus('error', "drawingstatus");
                }
            })
        }

        //  document.getElementById('downloadJson').addEventListener('click', downloadJson, false);

        function downloadPng() {
            var data = pad.canvas.toDataURL("image/png");
            this.href = data;
        }

        function changeDrawType(type, el) {
            // WebuiPopovers.hideAll();
            pad.setDrawType(type);
            drawType = type;

            var ch = $(el).children('span').html();

            $('#changeDrawType').html(ch);
            $('.list-group-item').removeClass('activeElement');
            $(el).addClass('activeElement');
            $('#changeDrawTypeAction').webuiPopover('hide');
            drawonPhoto();

        }
@endif
        //document.getElementById('downloadPng').addEventListener('click', downloadPng, false);

        // resize
        window.onresize = function (e) {
            $('#sketchpad').height($('#annotations-img').outerHeight());
            $('#sketchpad').width($('#annotations-img').outerWidth());
            $('#annotations-container').height($('#annotations-img').outerHeight());
            $('#annotations-container').width($('#annotations-img').outerWidth());
            WebuiPopovers.hideAll();
            loadData();

            pad.lineWidth = pad.lineWidth * (el.offsetWidth / pad.canvas.width)
            pad.setCanvasSize(el.offsetWidth, el.offsetHeight);
            pad.redraw();

            $('#zoomArea').css('height', 'Calc('+$(window).height()+'px - '+$('#topContent').height()+'px)');

            // update slider container height on page loaded
            const sliderHeight = 'Calc('+$(window).height()+'px - '+$('#topContent').height()+'px)'
            $('#customImageSlider').css('height', sliderHeight);
            $('.slider-before').css('height', sliderHeight);
            $('.slider-after').css('height', sliderHeight);
        }

        window.onload = function () {

            var mainImg = document.getElementById('annotations-img');

            mainImg.onload = function () {
                $('#sketchpad').height($('#annotations-img').outerHeight());
                $('#sketchpad').width($('#annotations-img').outerWidth());
                $('#annotations-container').height($('#annotations-img').outerHeight());
                $('#annotations-container').width($('#annotations-img').outerWidth());
                WebuiPopovers.hideAll();
                loadData();

                pad.lineWidth = pad.lineWidth * (el.offsetWidth / pad.canvas.width)
                pad.setCanvasSize(el.offsetWidth, el.offsetHeight);
                pad.redraw();

                $('#zoomArea').css('height', 'Calc('+$(window).height()+'px - '+$('#topContent').height()+'px)');
            };


        };

        pad.setReadOnly(true);

        function padReadOnly(val = true) {

            pad.setReadOnly(val);


        }

        function removeStroke(id){
            pad.removeStroke(id);
        }

        function pushElement(t, id, type, size, color){
            pad.pushElement(t, id, type, size, color);

        }



    </script>

    <script>
        var is_zoom_selected = false;
        var is_chat_visible = true;
        var is_annotations_active = false;
        var annotations_count = {{count($proof->annotations)}};
        var reply_id = 0;
        var edit_msg = '';
        var edit_id = 0;
        var edit_uuid = 0;

        var xx = 0;
        var yy = 0;
        var tags = '';



        $('#annotationFollower').html(annotations_count + 1);

    </script>

    <script>



        function loadData() {
            $('#annotations-container .annotations').remove();
            pad.clear();
            var annotation = '';
            annotations_count = 0;
            $('#annotationFollower').html(annotations_count + 1);
            sessionData.forEach(function (el) {
                // console.log(el);

                if (el.session_id == '{{$proof->session_id}}') {

                    var Acount = 0;
                    el.annotations.forEach(function (a) {
                        // console.log(a.type);
                        if (a.type == 1 && a.session_upload_id == currentProof) {
                            Acount++;
                            annotations_count = Acount;
                            $('#annotationFollower').html(annotations_count + 1);
                            annotation += '<div class="position-absolute annotations"  docId="' + a.id + '"  style="top:' + a.y + '%;left:' + a.x + '%" id="annotation-' + a.id + '-' + a.session_upload_id + '" bubbleref="bubble-' + a.id + '-' + a.session_upload_id + '"> ' + Acount + '</div>';
                        }

                        if (a.type == 2 && a.session_upload_id == currentProof) {
                            var data = JSON.parse(a.content);
                            pad.loadJSON(data);
                        }


                    })


                }

            });


            $('#annotations-container').append(annotation);
            addAnnotationHover();


        }

        function copyAllTexts(){
            var text = "";
            var count=0;
            var regex = /<br\s*[\/]?>/gi;
            var toast = new iqwerty.toast.Toast();
            sessionData.forEach(function (el) {


                if (el.session_id == '{{$proof->session_id}}') {


                    el.annotations.forEach(function (a) {
                        if (a.type == 1 && a.session_upload_id == currentProof) {
                            count++;
                            text=text+"MR"+count+":"+a.content.replace(regex,'\n')+"\n";

                        }




                    })
                    if(text!=""){
                    var dummy = document.createElement("textarea");

                    document.body.appendChild(dummy);
                    dummy.value = "FeedBack Date: {{date('d-m-y h:i A', strtotime($submitedDate))}}\n"+text;
                    dummy.select();
                    document.execCommand("copy");
                    document.body.removeChild(dummy);

                    toast.setText('Texts are copied').setDuration(2000).show();


                }
                }

            });
        }


        function getAnnotatedCount(){
            var Acount = 0;
            var s='';
            sessionData.forEach(function (el) {


                if (el.session_id == '{{$proof->session_id}}') {
                    if(el.annotations.length>0){
                        Acount++;
                    }




                }

            });
            if(Acount>1) s='s';

            return "You annotated "+Acount+" item"+s+" out of "+sessionData.length+"."
        }

        function confirmSubmit() {
            Swal.fire({
                title: 'Are you sure?',
                text: getAnnotatedCount(),
                icon: '',
                showCancelButton: true,
                showCloseButton:true,
                confirmButtonColor: '#0F7173',
                cancelButtonColor: '#FFFFFF',
                confirmButtonText: 'Yes',
                cancelButtonText: 'Back to edits',
                reverseButtons:true,
                customClass: {

                    confirmButton: 'btn btn-primary rounded px-10 py-1',
                    title: 'text-primary fs-36 font-weight-bold',

                    cancelButton: 'btn btn-white text-dark rounded shadow px-10 py-1',

                }
            }).then((result) => {
                if (result.isConfirmed) {
                    $('#submitForm').submit();
                }else{
                    return false;
                }
            })

            return false;
        }




    </script>


    <script>


        $(document).ready(function () {
            $('#zoomArea').css('height', 'Calc('+$(window).height()+'px - '+$('#topContent').height()+'px)');

            //Load Sketchpad
            $('#sketchpad').height($('#annotations-img').outerHeight());
            $('#sketchpad').width($('#annotations-img').outerWidth());
            $('#annotations-container').height($('#annotations-img').outerHeight());
            $('#annotations-container').width($('#annotations-img').outerWidth());
            WebuiPopovers.hideAll();
            loadData();

            pad.lineWidth = pad.lineWidth * (el.offsetWidth / pad.canvas.width)
            pad.setCanvasSize(el.offsetWidth, el.offsetHeight);
            pad.redraw();

            $("#sketchpad").on("mousemove", function (event) {
                event.stopPropagation();
                event.preventDefault();
                // if(isAnnotationDisplayed) return false;
                $('#annotationFollower').html(annotations_count + 1);
                if (!is_zoom_selected && is_annotations_active) {

                    bounds = this.getBoundingClientRect();
                    var left = bounds.left;
                    var top = bounds.top;
                    var x = event.pageX - left;
                    var y = event.pageY - top;
                    var cw = this.clientWidth
                    var ch = this.clientHeight
                    var iw = this.naturalWidth
                    var ih = this.naturalHeight
                    var px = x / cw * iw
                    var py = y / ch * ih
                    xx = ((event.offsetX - 16) / cw) * 100;
                    yy = ((event.offsetY - 16) / ch) * 100;

                    var follower = document.getElementById('annotationFollower');
                    if (is_annotations_active) {
                        $('#sketchpad >canvas').addClass('nocursor');
                        $('#annotationFollower').removeClass('d-none');
                        follower.style.top = (yy) + '%';

                        follower.style.left = (xx) + '%';

                    } else {
                        $('#sketchpad >canvas').removeClass('nocursor');
                        $('#annotationFollower').addClass('d-none');
                        follower.style.top = '0px';
                        follower.style.left = '0px';

                    }


                }
            });

            // todo
            $("#sketchpad").on("click", function (event) {
                event.stopPropagation();
                event.preventDefault();
                //if(isAnnotationDisplayed) return false;

                if (!is_zoom_selected && is_annotations_active) {

                    var follower = document.getElementById('annotationFollower');
                    $('#sketchpad >canvas').removeClass('nocursor');
                    $('#annotationFollower').addClass('d-none');
                    follower.style.top = '0px';
                    follower.style.left = '0px';

                    annotations_count++;
                    bounds = this.getBoundingClientRect();
                    var left = bounds.left;
                    var top = bounds.top;
                    var x = event.pageX - left;
                    var y = event.pageY - top;
                    var cw = this.clientWidth
                    var ch = this.clientHeight
                    var iw = this.naturalWidth
                    var ih = this.naturalHeight
                    var px = x / cw * iw
                    var py = y / ch * ih
                    xx = ((event.offsetX - 16) / cw) * 100;
                    yy = ((event.offsetY - 16) / ch) * 100;

                    var data = {
                        'type': 1,
                        'x': xx,
                        'y': yy,
                        'session_upload_id': currentProof,
                        'sessionId': '{{$sessionId}}'
                    };

                    ApiGetData('{{url('account/annotations')}}', 'POST', data).then(function (createAnnotation) {

                        if (createAnnotation.status == 1) {

                            $('.actionbtn').attr('disabled', 'true');
                            $('.sp-container').addClass('d-none');
                            $("#ine-color-input").spectrum("disable");
                            dataId = createAnnotation.currentData.id;
                            dataUnique = dataId + '-' + createAnnotation.currentData.session_upload_id;
                            sessionData = createAnnotation.data;
                            //loadData();


                            var annotation = '<div class="position-absolute annotations " data-id="' + dataId + '" data-placement="auto"  style="top:' + yy + '%;left:' + xx + '%" id="annotation' + dataUnique + '" bubbleref="bubble' + dataUnique + '"> ' + annotations_count + '</div>';
                            $('#annotations-container').append(annotation);
                            is_annotations_active = false;
                            $('#escmode').addClass('d-none');
                            $('#annotations-container').removeClass('hoverDisabled');
                            if (is_chat_visible) showSidebar();
                            $('#annotation' + dataUnique).webuiPopover('destroy');
                            $('#annotation' + dataUnique).webuiPopover({
                                trigger: 'manual',
                                //backdrop: false,//if backdrop is set to true, popover will use backdrop on open
                                dismissible: true,
                                closeable: true,
                                autoHide: false,
                                multiple: true,
                                cache: true,
                                backdrop: true,


                                onHide: function ($element) {

                                    $('#annotations-container').removeClass('hoverDisabled');

                                    $('.actionbtn').removeAttr('disabled');
                                    $('.sp-container').removeClass('d-none');

                                    $("#ine-color-input").spectrum("enable");
                                    isAnnotationDisplayed = false;
                                    lastId = 0;
                                    if ( $('#annotation-comment' + dataUnique).attr('data-is-empty') == 'empty' ) {

                                        removeAnnotation(createAnnotation.currentData.id) ;
                                    }
                                    addAnnotations();
                                    loadData();
                                },
                                content: '<div style="min-width: 300px;"><button onclick="removeAnnotation(\''+dataId+'\')" class=" border-0 btn-white text-red" style=" width: 32px; position: absolute; z-index: 9; right: 8px; top:46px; padding: 0px; "> <i class="uil uil-trash-alt"></i></button> <div class="w-100"> <div class="mb-3"> <div id="savingstatus-' + dataUnique+'"></div> <div class="form-icon position-relative annotation-input">  <div class="form-control mention textarea"  name="description" placeholder="Type text..."  id="annotation-comment' + dataUnique + '"></div> </div> </div> </div> <div><input type="file" name="files" id="annotation-uploader-' + dataUnique + '"></div> </div>'
                            });
                            $('#annotations-container').addClass('hoverDisabled');
                            //editable

                            setTimeout(function () {
                                // console.log(dataId);
                                $('#annotation' + dataUnique).webuiPopover('show');
                                $(".webui-popover").click(function(e){
                                    e.stopPropagation();
                                });
                                handleUploader('#annotation-uploader-' + dataUnique);
                                isAnnotationDisplayed = true;
                                lastId = dataId;
                                $('#annotation-comment' + dataUnique).editable({

                                    // trigger event
                                    event: 'click',
                                    emptyMessage: 'Type text...',

                                    // enables touch event
                                    touch: true,

                                    // converts \n to <br />
                                    lineBreaks: true,

                                    // allows to change font size
                                    toggleFontSize: false,

                                    // close on enter
                                    closeOnEnter: false,


                                    // integrates with tinyMCE
                                    tinyMCE: false,

                                    // additional editor styles
                                    editorStyle: {
                                        'width': '100%',
                                        'background-color': '#333',
                                        'border': 'none'
                                    },

                                    // callback function
                                    callback: function (data) {
                                        if (data.content) {
                                            showSavingStatus('saving', "savingstatus-" + dataUnique);
                                            var datas = {
                                                'id': dataId,
                                                'sessionId': '{{$sessionId}}',
                                                'content': data.content
                                            };
                                            ApiGetData('{{url('account/annotations')}}', 'PUT', datas).then(function (e) {
                                                if (e.status == 1) {
                                                    sessionData = e.data;
                                                    showSavingStatus('saved', "savingstatus-" + dataUnique);

                                                } else {
                                                    showSavingStatus('error', "savingstatus-" + dataUnique);
                                                    //TODO: warning alert
                                                }
                                            })

                                        }
                                        if (data.fontSize) {
                                            // the font size has changed
                                        }


                                    }

                                });

                                loadData();
                                $('#annotation-comment' + dataUnique).editable('open');
                            }, 500);


                        }
                    });


                } else {
                    saveJson();
                    pad.redraw();
                }


            });
        });


        function handleUploader(id, webuiPopoverData=null) {
            var api = $.fileuploader.getInstance(id);
            if (typeof api != 'undefined' && api !=null && typeof $(id)!='undefined')
                api.destroy();

            $(id).fileuploader({
                extensions: null,
                changeInput: ' ',
                theme: 'thumbnails',
                enableApi: true,
                addMore: true,
                clipboardPaste: 500,
                thumbnails: {
                    box: '<div class="fileuploader-items">' +
                        '<ul class="fileuploader-items-list">' +
                            @if(!$isSubmited)   '<li class="fileuploader-thumbnails-input" style=" position: absolute; top: 58px; right: 36px; width: 32px; height: 32px; font-size: 12px; "><div style="  font-size: 17px; height: 100% !important; background-color: transparent; color:#606060" class="fileuploader-thumbnails-input-inner"><i class="uil uil-paperclip"></i></div></li>' + @endif

                        '</ul>' +
                        '</div>',
                    item: '<li class="fileuploader-item itooltip itooltip-primary" title="${name}">' +
                        '<div class="fileuploader-item-inner">' +
                        '' +
                        '<div class="actions-holder">' +
                            @if(!$isSubmited)  '<button type="button" class="fileuploader-action fileuploader-action-remove" title="${captions.remove}"><i class="uil uil-times"></i></button>' + @endif
                        '</div>' +
                        '<div class="thumbnail-holder">' +
                        '${image}' +
                        '<span class="fileuploader-action-popup"></span>' +
                        '</div>' +
                        '<div class="content-holder"><span>${size2}</span></div>' +
                        '<div class="progress-holder">${progressBar}</div>' +
                        '</div>' +
                        '</li>',
                    item2: '<li class="fileuploader-item">' +
                        '<div class="fileuploader-item-inner">' +
                        '<div class="actions-holder">' +
                        '<a href="${file}" class="fileuploader-action fileuploader-action-download" title="${captions.download}" download><i class="uil uil-download-alt"></i></a>' +
                            @if(!$isSubmited)   '<button type="button" class="fileuploader-action fileuploader-action-remove" title="${captions.remove}"><i class="uil uil-times"></i></button>' + @endif
                        '</div>' +
                        '<div class="thumbnail-holder">' +
                        '${image}' +

                        '</div>' +
                        '<div class="content-holder"><h5 title="${name}">${name}</h5><span>${size2}</span></div>' +
                        '<div class="progress-holder">${progressBar}</div>' +
                        '</div>' +
                        '</li>',
                    startImageRenderer: true,
                    canvasImage: true,
                    _selectors: {
                        list: '.fileuploader-items-list',
                        item: '.fileuploader-item',
                        start: '.fileuploader-action-start',
                        retry: '.fileuploader-action-retry',
                        remove: '.fileuploader-action-remove'
                    },
                    onItemShow: function (item, listEl, parentEl, newInputEl, inputEl) {
                        var plusInput = listEl.find('.fileuploader-thumbnails-input'),
                            api = $.fileuploader.getInstance(inputEl.get(0));

                        plusInput.insertAfter(item.html)[api.getOptions().limit && api.getChoosedFiles().length >= api.getOptions().limit ? 'hide' : 'show']();

                        if (item.format == 'image') {
                            item.html.find('.fileuploader-item-icon').hide();
                        }
                    },
                    onItemRemove: function (html, listEl, parentEl, newInputEl, inputEl) {
                        var plusInput = listEl.find('.fileuploader-thumbnails-input'),
                            api = $.fileuploader.getInstance(inputEl.get(0));

                        html.children().animate({'opacity': 0}, 200, function () {
                            html.remove();

                            if (api.getOptions().limit && api.getChoosedFiles().length - 1 < api.getOptions().limit)
                                plusInput.show();
                        });
                    }
                },
                dragDrop: {
                    container: '.fileuploader-thumbnails-input'
                },
                afterRender: function (listEl, parentEl, newInputEl, inputEl) {
                    var plusInput = listEl.find('.fileuploader-thumbnails-input'),
                        api = $.fileuploader.getInstance(inputEl.get(0));

                    plusInput.on('click', function () {
                        api.open();
                    });

                    api.getOptions().dragDrop.container = plusInput;
                },

                @if(!$isSubmited)  
                    upload: {
                        url: '{{url('account/annotation/addfile/')}}/' + dataId,
                        data: null,
                        type: 'POST',
                        enctype: 'multipart/form-data',
                        start: true,
                        synchron: true,
                        beforeSend: null,
                        onSuccess: function (result, item) {
                            $('#sharedLink').removeClass('d-none');
                            var data = {};

                            if (result && result.files)
                                data = result;
                            else
                                data.hasWarnings = true;

                            // if success
                            if (data.isSuccess && data.files.length) {
                                item.name = data.files[0].name;
                                forceReload();
                                item.html.find('.content-holder > h5').text(item.name).attr('title', item.name);
                            }

                            // if warnings
                            if (data.hasWarnings) {
                                for (var warning in data.warnings) {
                                    alert(data.warnings[warning]);
                                }

                                item.html.removeClass('upload-successful').addClass('upload-failed');
                                return this.onError ? this.onError(item) : null;
                            }

                            item.html.find('.fileuploader-action-remove').addClass('fileuploader-action-success');

                            setTimeout(function () {
                                item.html.find('.progress-holder').hide();
                                item.renderThumbnail();
                                item.html.find('.fileuploader-action-popup, .fileuploader-item-image').show();

                                if(webuiPopoverData){
                                    const {elm, listSettings, annotation} = webuiPopoverData
                                    // get lastest comment content
                                    const content = getPopoverContent(annotation, true)
                                    const updatedListSettings = { ...listSettings, content} 

                                    closeWebuiPopover(elm) // close popover
                                    openWebuiPopover({elm, listSettings: updatedListSettings, annotation}) // open popover 
                                    handleUploader('#annotation-uploader-' + annotation.id, {elm, listSettings: updatedListSettings, annotation}); // load uploader
                                    loadCommentField({annotation}) // load comment field 
                                }
                            }, 400);
                            $(window).off('beforeunload');
                        },
                        onError: function (item) {
                            item.html.find('.progress-holder, .fileuploader-action-popup, .fileuploader-item-image').hide();
                        },
                        onProgress: function (data, item) {
                            $(window).on('beforeunload', function (e)
                            {
                                return "Data will be lost if you leave the page, are you sure?";
                            });
                            var progressBar = item.html.find('.progress-holder');

                            if (progressBar.length > 0) {
                                progressBar.show();
                                progressBar.find('.fileuploader-progressbar .bar').width(data.percentage + "%");
                            }

                            item.html.find('.fileuploader-action-popup, .fileuploader-item-image').hide();
                        }
                },  
                onRemove: function (item) {
                    var data = {'sessionId': '{{$sessionId}}'};
                    ApiGetData('{{url('account/annotation/deletefile')}}/' + item.name, 'POST', data).then(function (e) {
                        if(e==1)forceReload();
                    })
                }@endif
            });

            // fech saved files
            var api = $.fileuploader.getInstance(id);
            sessionData.forEach(function (el) {
                if (el.session_id == '{{$proof->session_id}}') {
                    el.files.forEach(function (f) {
                        if (f.annotation_id == lastId) {
                            var preload = {
                                'name': f.filePath,
                                'type': f.type,
                                'size': f.size,
                                'file': '{{url('uploads/proofs/annoationsfiles/')}}/' + f.filePath,
                                'image': '{{url('uploads/proofs/annoationsfiles/')}}/' + f.filePath,
                                'data': {
                                    'readerForce': true,
                                    'thumbnail':'{{url('uploads/proofs/annoationsfiles/')}}/' + f.filePath,
                                    'url': '{{url('uploads/proofs/annoationsfiles/')}}/' + f.filePath,
                                    'image': '{{url('uploads/proofs/annoationsfiles/')}}/' + f.filePath,
                                    'date': f.created_at,
                                    'isMain': 0,
                                    'listProps': { 'id': f.id }
                                },
                            };
                            // console.log(preload);
                            api.append(preload);
                        }  
                    })
                }
            });
        }

        @if(!$isSubmited)
        function showCoords(event, left, top, element) {
            var x = event.offsetX;
            var y = event.offsetY;
            var coor = "X coords: " + (x + 14) + ", Y coords: " + (y - 2);
            //document.getElementById("mouseCoord").innerHTML = coor;
            var follower = document.getElementById('annotationFollower');
            if (is_annotations_active) {
                $('#sketchpad >canvas').addClass('nocursor');
                $('#annotationFollower').removeClass('d-none');
                follower.style.top = (y + element.style.top - 16) + 'px';

                follower.style.left = (x + element.style.left - 8) + 'px';

            } else {
                $('#sketchpad >canvas').removeClass('nocursor');
                $('#annotationFollower').addClass('d-none');
                follower.style.top = '0px';
                follower.style.left = '0px';

            }

            /*
                (function() {
                    var follower, init, mouseX, mouseY, positionElement, printout, timer;

                    follower = document.getElementById('follower');

                    printout = document.getElementById('printout');

                    mouseX = (event) => {
                        return event.clientX;
                    };

                    mouseY = (event) => {
                        return event.clientY;
                    };

                    positionElement = (event) => {
                        var mouse;
                        mouse = {
                        x: mouseX(event),
                        y: mouseY(event)
                        };
                        follower.style.top = mouse.y + 'px';
                        return follower.style.left = mouse.x + 'px';
                    };

                    timer = false;

                    window.onmousemove = init = (event) => {
                        var _event;
                        _event = event;
                        return timer = setTimeout(() => {
                        return positionElement(_event);
                        }, 1);
                    };

}).call(this);

            */
        }

        function clearCoords() {
            document.getElementById("mouseCoord").innerHTML = "";
            var follower = document.getElementById('annotationFollower');
            $('#sketchpad >canvas').removeClass('nocursor');
            $('#annotationFollower').addClass('d-none');
            follower.style.top = '0px';
            follower.style.left = '0px';
        }

        //Zoom

        function magnify(imgID, zoom) {
            if (is_zoom_selected) {
                var img, glass, w, h, bw;
                img = document.getElementById(imgID);
                /*create magnifier glass:*/
                glass = document.createElement("DIV");
                glass.setAttribute("class", "img-magnifier-glass");
                /*insert magnifier glass:*/
                img.parentElement.insertBefore(glass, img);
                /*set background properties for the magnifier glass:*/
                glass.style.backgroundImage = "url('" + img.src + "')";
                glass.style.backgroundRepeat = "no-repeat";
                glass.style.backgroundSize = (img.width * zoom) + "px " + (img.height * zoom) + "px";
                bw = 3;
                w = glass.offsetWidth / 2;
                h = glass.offsetHeight / 2;
                /*execute a function when someone moves the magnifier glass over the image:*/
                glass.addEventListener("mousemove", moveMagnifier);
                img.addEventListener("mousemove", moveMagnifier);
                /*and also for touch screens:*/
                glass.addEventListener("touchmove", moveMagnifier);
                img.addEventListener("touchmove", moveMagnifier);

                function moveMagnifier(e) {
                    var pos, x, y;
                    /*prevent any other actions that may occur when moving over the image*/
                    e.preventDefault();
                    /*get the cursor's x and y positions:*/
                    pos = getCursorPos(e);
                    x = pos.x;
                    y = pos.y;
                    /*prevent the magnifier glass from being positioned outside the image:*/
                    if (x > img.width - (w / zoom)) {
                        x = img.width - (w / zoom);
                    }
                    if (x < w / zoom) {
                        x = w / zoom;
                    }
                    if (y > img.height - (h / zoom)) {
                        y = img.height - (h / zoom);
                    }
                    if (y < h / zoom) {
                        y = h / zoom;
                    }
                    /*set the position of the magnifier glass:*/
                    glass.style.left = (x - w) + "px";
                    glass.style.top = (y - h) + "px";
                    /*display what the magnifier glass "sees":*/
                    glass.style.backgroundPosition = "-" + ((x * zoom) - w + bw) + "px -" + ((y * zoom) - h + bw) + "px";
                }

                function getCursorPos(e) {
                    var a, x = 0, y = 0;
                    e = e || window.event;
                    /*get the x and y positions of the image:*/
                    a = img.getBoundingClientRect();
                    /*calculate the cursor's x and y coordinates, relative to the image:*/
                    x = e.pageX - a.left;
                    y = e.pageY - a.top;
                    /*consider any page scrolling:*/
                    x = x - window.pageXOffset;
                    y = y - window.pageYOffset;
                    return {x: x, y: y};
                }

            }
        }

        function hideElements() {
            WebuiPopovers.hideAll();
            if (isHidden) {

                $('#hideBtn').removeClass('hideIcon').addClass('unhideIcon');

                $('#annotations-container').removeClass('d-none');
                $('#sketchpad').removeClass('d-none');
                $('#hideBtn').removeClass('activeDraw');
                isHidden = false;
            } else {
                $('#hideBtn').removeClass('unhideIcon').addClass('hideIcon');
                $('#annotations-container').addClass('d-none');
                $('#sketchpad').addClass('d-none');
                $('#hideBtn').addClass('activeDraw');
                isHidden = true;
            }
        }

        function resetView() {
            WebuiPopovers.hideAll();
            $('#annotations-container').removeClass('d-none');
            $('#hideBtn').removeClass('activeDraw');
            $('#hideBtn').removeClass('hideIcon').addClass('unhideIcon');
            $('#sketchpad').removeClass('d-none');
            $('#changeDrawType').removeClass('activeDraw');
            $('#changeDrawTypeAction').removeClass('activeDraw');
            $('.addannotationIcon').removeClass('activeDraw');

            isClearing = false;
            padReadOnly(true);
            pad.setDrawType(drawType);
            $('#clear').removeClass('AclearIcon').addClass('clearIcon');
            isHidden = false;

            // before / after
            isBeforeAfterMode = false;
            $('#zoomArea').removeClass('d-none');
            $('#customImageSlider').addClass('d-none');
            $('#beforeAfterBtn').removeClass('activeDraw');

            if (is_zoom_selected) {
                is_zoom_selected = false;

                $('.img-magnifier-glass').remove();


                // $('#annotations-container').removeClass('hoverDisabled');
            }

            if (is_annotations_active) {

                is_annotations_active = false;


            }
            $('#annotations-container').removeClass('hoverDisabled');

            if (is_chat_visible) showSidebar();

            if (!$('#fullscreenmode').hasClass('fullscreen')) {

                $('#fullscreenmode').addClass('fullscreen');
                $('#fullscreenmode').html('<i class="mdi mdi-fullscreen"></i>');

            }

            $('#escmode').addClass('d-none');

            $('#toolBox').removeClass('d-none').addClass('d-none');
        }

        function zoom() {
            padReadOnly(true);
            $('#toolBox').removeClass('d-none').addClass('d-none');
            if (is_zoom_selected == false) {

                is_zoom_selected = true;
                hideSidebar();
                is_annotations_active = false;
                $('#annotations-container').addClass('hoverDisabled');

                magnify("annotations-img", 6);
                $('#escmode').removeClass('d-none');
            } else {
                $('#annotations-container').removeClass('hoverDisabled');
                is_zoom_selected = false;
                if (is_chat_visible) showSidebar();


                is_annotations_active = false;

                $('.img-magnifier-glass').remove();
                $('#escmode').addClass('d-none');
            }
        }

        $(document).keyup(function (e) {
            if (e.key === "Escape") { // escape key maps to keycode `27`
                resetView();
            }
        });

        $(function () {

            $('textarea.mention').mentionsInput({
                onDataRequest: function (mode, query, callback) {
                    var data = [
                        <?php
                        $members = array();
                        //\SiteHelpers::getMemberslistg($proof->product_id);
                        echo "/*";
                        print_r($members);

                        echo "*/ ";

                        $mhtml = "";
                        foreach ($members as $mm) {
                            if (!empty($mm->id)) {

                                $mhtml .= "{
                            id: " . $mm->id . ",
                            name: ' " . strtoupper($mm->last_name) . " " . ucfirst($mm->first_name) . "',
                            'avatar': '" . SiteHelpers::getUseravatari($mm->id) . "',
                            'type': 'contact'
                        },";
                            }
                        }

                        echo $mhtml;
                        ?>

                    ];

                    data = _.filter(data, function (item) {
                        return item.name.toLowerCase().indexOf(query.toLowerCase()) > -1
                    });

                    callback.call(this, data);
                }
            });

            $('.get-syntax-text').click(function () {
                $('textarea.mention').mentionsInput('val', function (text) {
                    alert(text);
                });
            });

            $('.get-mentions').click(function () {
                $('textarea.mention').mentionsInput('getMentions', function (data) {
                    alert(JSON.stringify(data));
                });
            });

        });

        function showChat() {
            return true;
        }

        function addAnnotations() {
            lastId=0;
            WebuiPopovers.hideAll();
            $('#annotations-container').removeClass('d-none');
            $('#hideBtn').removeClass('activeDraw');
            $('#hideBtn').removeClass('hideIcon').addClass('unhideIcon');
            $('.addannotationIcon').addClass('activeDraw');
            $('#changeDrawType').removeClass('activeDraw');
            $('#changeDrawTypeAction').removeClass('activeDraw');
            $('#sketchpad').removeClass('d-none');
            isHidden = false;
            padReadOnly(true);
            isClearing = false;
            pad.setDrawType(drawType);
            $('#clear').removeClass('AclearIcon').addClass('clearIcon');

            // before / after
            isBeforeAfterMode = false;
            $('#zoomArea').removeClass('d-none');
            $('#customImageSlider').addClass('d-none');
            $('#beforeAfterBtn').removeClass('activeDraw');

            $('#toolBox').removeClass('d-none').addClass('d-none');

            is_zoom_selected = false;
            $('.img-magnifier-glass').remove();
            hideSidebar();
            is_annotations_active = true;
            $('#annotations-container').addClass('hoverDisabled');
            $('#escmode').removeClass('d-none');

        }

        function drawonPhoto() {
            WebuiPopovers.hideAll();
            $('#annotations-container').removeClass('d-none');
            $('#hideBtn').removeClass('activeDraw');
            $('#hideBtn').removeClass('hideIcon').addClass('unhideIcon');
            $('.addannotationIcon').removeClass('activeDraw');
            $('#changeDrawType').addClass('activeDraw');
            $('#changeDrawTypeAction').addClass('activeDraw');
            $('#sketchpad').removeClass('d-none');
            if (isClearing) {
                isClearing = false;
                pad.setDrawType(drawType);
                $('#clear').removeClass('AclearIcon').addClass('clearIcon');
            }
            isHidden = false;

            // before / after 
            isBeforeAfterMode = false;
            $('#zoomArea').removeClass('d-none');
            $('#customImageSlider').addClass('d-none');
            $('#beforeAfterBtn').removeClass('activeDraw');

            $('#toolBox').removeClass('d-none');
            padReadOnly(false);
            is_zoom_selected = false;
            $('.img-magnifier-glass').remove();
            hideSidebar();
            is_annotations_active = false;
            $('#annotations-container').addClass('hoverDisabled');

            $('#escmode').removeClass('d-none');
            $('#zoomArea').css('height', 'Calc('+$(window).height()+'px - '+$('#topContent').height()+'px)');

            $('#sketchpad').height($('#annotations-img').outerHeight());
            $('#sketchpad').width($('#annotations-img').outerWidth());
            $('#annotations-container').height($('#annotations-img').outerHeight());
            $('#annotations-container').width($('#annotations-img').outerWidth());
            WebuiPopovers.hideAll();
            loadData();

            pad.lineWidth = pad.lineWidth * (el.offsetWidth / pad.canvas.width)
            pad.setCanvasSize(el.offsetWidth, el.offsetHeight);
            pad.redraw();

        }

        function forceReload() {
            var data = {'sessionId': '{{$sessionId}}'};

            ApiGetData('{{url('account/getall/')}}/{{$sessionId}}', 'GET', data).then(function (e) {
                    // console.log(e)
                    sessionData = e;
                   // isAnnotationDisplayed=false;;



            })


        }
        function removeAnnotation(id) {
            var data = {'id': id, 'sessionId': '{{$sessionId}}'};

            ApiGetData('{{url('account/annotations')}}', 'DELETE', data).then(function (e) {
                if (e.status == 1) {
                    sessionData = e.data;
                    isAnnotationDisplayed=false;
                    $('#annotation' + id).webuiPopover('destroy');
                    WebuiPopovers.hideAll();
                    $('#annotation' + id).remove();
                    $(".annotation-input textarea").val("");

                    loadData();
                    resetView();
                } else {
                    //TODO: warning alert
                }
            })


        }
        @endif


        function closeWebuiPopover(elm){
            console.log("closed ....", elm.id)
            isAnnotationDisplayed = false;
            $('.actionbtn').removeAttr('disabled');
            $('.sp-container').removeClass('d-none');
            $('#' + elm.id).webuiPopover('destroy'); // close popover
            $("#ine-color-input").spectrum("enable");
            loadData();
        }
        function openWebuiPopover({elm, listSettings, annotation}){
            // ** clear popovers
            WebuiPopovers.hideAll();
            $('#' + elm.id).webuiPopover('destroy');

            // ** display popover 
            console.log("opened ....", elm.id)
            WebuiPopovers.show('#' + elm.id, $.extend({}, settings, listSettings));
            $(".webui-popover").click(function(e){
                e.stopPropagation();
            });
            if ($('#annotation-uploader-' + annotation.id).is(':editable')) {
                $('#annotation-uploader-' + annotation.id).editable('destroy');
            }
        }
        function getPopoverContent(oldAnnotation, update = false){
            let annotation = oldAnnotation
            if(update){
                const annotationsData = sessionData?.find((session) => session.session_id == '{{$proof->session_id}}')?.annotations || [] 
                annotation = annotationsData.find((item) => item.type == 1 && item.id == oldAnnotation.id) || oldAnnotation
            }   
            const dataId = annotation.id;
            return '<div style="min-width: 300px;">@if(!$isSubmited)<button onclick="removeAnnotation(\''+dataId+'\')" class="border-0 btn-white text-red" style=" width: 32px; position: absolute; z-index: 9; right: 8px; top:46px; padding: 0px; "> <i class="uil uil-trash-alt"></i></button> @endif <div class="w-100"> <div class="mb-3"> <div id="savingstatus-' +dataId+'"></div> <div class="form-icon position-relative annotation-input">  <div class="form-control mention textarea"  name="description" placeholder="Type text..."  id="annotation-comment' + dataId + '">' + annotation.content + '</div> </div> </div> </div> <div><input type="file" name="files" id="annotation-uploader-' + dataId + '"></div> </div>'
        }
        function loadCommentField({annotation}){
            isAnnotationDisplayed = true;
            @if(!$isSubmited)
                $('#annotation-comment' + annotation.id).editable({
                    // trigger event
                    event: 'click',
                    emptyMessage: 'Type text...',
                    // enables touch event
                    touch: true,
                    // converts \n to <br />
                    lineBreaks: true,
                    // allows to change font size
                    toggleFontSize: false,
                    // close on enter
                    closeOnEnter: false,
                    // integrates with tinyMCE
                    tinyMCE: false,
                    // additional editor styles
                    editorStyle: {
                        'width': '100%',
                        'background-color': '#333',
                        'border': 'none'
                    },

                    // callback function
                    callback: function (data) {
                        if (data.content) {
                            showSavingStatus('saving', "savingstatus-" + annotation.id);
                            var payload = {
                                'id': annotation.id,
                                'sessionId': '{{$sessionId}}',
                                'content': data.content
                            };
                            ApiGetData('{{url('account/annotations')}}', 'PUT', payload).then(function (e) {
                                if (e.status == 1) {
                                    sessionData = e.data;
                                    showSavingStatus('saved', "savingstatus-" + annotation.id);
                                } else {
                                    //TODO: warning alert
                                    showSavingStatus('error', "savingstatus-" + annotation.id);
                                }
                            })

                        }
                        if (data.fontSize) {
                            // the font size has changed
                        }
                    }
                });
                $('#annotation-comment' + annotation.id).editable('open');
            @endif
        }

        function addAnnotationHover() {
            $(".annotations").hover(function () {
                    //  $(this).addClass('activeAnnotation');
                    var elm = this;
                    sessionData.forEach(function (el) {
                        if (el.session_id == '{{$proof->session_id}}') {
                            el.annotations.forEach(function (a) {
                                if (a.type == 1 && a.session_upload_id == currentProof && a.id == $(elm).attr('docid')) {
                                    if (lastId == a.id && isAnnotationDisplayed) {
                                        lastId = a.id;
                                        return false;
                                    } else {
                                        lastId = a.id;
                                        // WebuiPopovers.hideAll();
                                    }

                                    $('.actionbtn').attr('disabled', 'true');
                                    $('.sp-container').addClass('d-none');
                                    $("#ine-color-input").spectrum("disable");
                                    dataId = a.id;

                                    listSettings = {
                                        title: '',
                                        padding: true,
                                        width:360,
                                        //backdrop: false, //if backdrop is set to true, popover will use backdrop on open
                                        dismissible: true,
                                        closeable: true,
                                        autoHide: false,
                                        multiple: true,
                                        cache: true,
                                        onHide: function ($element) { closeWebuiPopover(elm) },
                                        content: getPopoverContent(a)
                                        //content: '<div style="min-width: 300px;">@if(!$isSubmited)<button onclick="removeAnnotation(\''+dataId+'\')" class="border-0 btn-white text-red" style=" width: 32px; position: absolute; z-index: 9; right: 8px; top:46px; padding: 0px; "> <i class="uil uil-trash-alt"></i></button> @endif <div class="w-100"> <div class="mb-3"> <div id="savingstatus-' + a.id+'"></div> <div class="form-icon position-relative annotation-input">  <div class="form-control mention textarea"  name="description" placeholder="Type text..."  id="annotation-comment' + dataId + '">' + a.content + '</div> </div> </div> </div> <div><input type="file" name="files" id="annotation-uploader-' + dataId + '"></div> </div>'
                                    };

                                    //.webuiPopover($.extend({},settings,listSettings));
                                    // timeago.render(document.querySelectorAll('.timeago_rendering'));

                                    setTimeout(function () {
                                        // ** open popover
                                        openWebuiPopover({elm, listSettings, annotation : a})
                                        // ** load uploader
                                        handleUploader('#annotation-uploader-' + a.id, {elm, listSettings, annotation : a});
                                        // ** load comment field
                                        loadCommentField({annotation: a})
                                    }, 200);
                                }
                            })
                        }
                    });
                },
                function () {
                    $(this).removeClass('activeAnnotation');
                    // $("#" + $(this).attr('bubbleref')).removeClass('activebubble');
                }
            );
        }

        @if(!$isSubmited)
        function addBubblesHover() {
            $(".bubbles").hover(function () {
                    $("#" + $(this).attr('annotationref')).addClass('activeAnnotation');
                    $("#" + $(this).attr('annotationref').replace('annotation', 'options')).removeClass('d-none');
                },
                function () {
                    $("#" + $(this).attr('annotationref')).removeClass('activeAnnotation');
                    $("#" + $(this).attr('annotationref').replace('annotation', 'options')).addClass('d-none');
                }
            );

        }

        //full screen
        function openFullscreen() {
            if ($('#fullscreenmode').hasClass('fullscreen')) {
                $('#fullscreenmode').removeClass('fullscreen');
                $('#fullscreenmode').html('<i class="mdi mdi-fullscreen-exit"></i>');
                elem = document.getElementById('AnnotationsArea');
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.mozRequestFullScreen) { /* Firefox */
                    elem.mozRequestFullScreen();
                } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) { /* IE/Edge */
                    elem.msRequestFullscreen();
                }

            } else {
                $('#fullscreenmode').addClass('fullscreen');
                $('#fullscreenmode').html('<i class="mdi mdi-fullscreen"></i>');
                closeFullscreen();
            }
        }
        function closeFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) { /* Firefox */
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE/Edge */
                document.msExitFullscreen();
            }
        }
        @endif

        // Time Ago
        const MONTH_NAMES = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];


        function getFormattedDate(date, prefomattedDate = false, hideYear = false) {
            const day = date.getDate();
            const month = MONTH_NAMES[date.getMonth()];
            const year = date.getFullYear();
            const hours = date.getHours();
            let minutes = date.getMinutes();

            if (minutes < 10) {
                // Adding leading zero to minutes
                minutes = `0${minutes}`;
            }

            if (prefomattedDate) {
                // Today at 10:20
                // Yesterday at 10:20
                return `${prefomattedDate} at ${hours}:${minutes}`;
            }

            if (hideYear) {
                // 10. January at 10:20
                return `${day}. ${month} at ${hours}:${minutes}`;
            }

            // 10. January 2017. at 10:20
            return `${day}. ${month} ${year}. at ${hours}:${minutes}`;
        }

        //side Bar

        let sidebar = $('.sidebar'),
            allDropdown = $('.sidebar-dropdown'),
            width = sidebar.width();

        function hideSidebar() {
            if (!sidebar.hasClass('hidden')) {
                $('.sidebar-header').addClass('d-none');
                $('#addannotationIcon').removeClass('d-none');
                sidebar.one('transitionend', function () {
                    sidebar.addClass('hidden');
                });
                sidebar.width(0);

            }
        }

        function showSidebar() {

            $('#addannotationIcon').addClass('d-none');

            if ($('#sideBarContent').html() == "") return;
            $('.sidebar-header').removeClass('d-none');
            sidebar.removeClass('hidden');
            sidebar.width(width);

        }

        function showLeftBar(id) {
            showReplys(id.replace('annotationhs', 'replys'));


        }


        function showReplys(id) {
            reply_id = id.replace('replys-', '');
            $('#HotspotsList li').removeClass('activeHotspot');
            $('#' + id.replace('replys', 'annotationhs')).addClass('activeHotspot');
            $('#sideBarContent').html('<div class="chat"><div class="chat-history p-2 m-0"><ul class="p-0 m-0">' + $('#' + id).html() + '</ul></div></div>');
            showSidebar();
            timeago.render(document.querySelectorAll('.timeago_rendering'));

        }

        function toggleSideBar() {
            if ($('#sideBarContent').html() == "") return;
            if (!sidebar.hasClass('hidden')) {
                $('.sidebar-header').addClass('d-none');
                sidebar.one('transitionend', function () {
                    sidebar.addClass('hidden');
                });
                sidebar.width(0);
            } else {
                // $('#sideBarContent').html('<div class="chat"><div class="chat-history p-2 m-0"><ul class="p-0 m-0">'+$('#messagesContent').html()+'</ul></div></div>');
                $('.sidebar-header').removeClass('d-none');
                sidebar.removeClass('hidden');
                sidebar.width(width);
                addBubblesHover();
            }
        }

        function dropdown() {
            let parent = $(this).parent('.sidebar-dropdown');
            if (parent.hasClass('active')) {
                parent.removeClass('active');
            } else {
                allDropdown.removeClass('active');
                parent.addClass('active');
            }
        }


        $('.sidebar-dropdown a').on('click', dropdown);
        hideSidebar();

        // --- Main function

        function timeAgo(dateParam) {
            //  return "";
            if (!dateParam) {
                return null;
            }

            const date = typeof dateParam === 'object' ? dateParam : new Date(dateParam);
            const DAY_IN_MS = 86400000; // 24 * 60 * 60 * 1000
            const today = new Date();
            const yesterday = new Date(today - DAY_IN_MS);
            const seconds = Math.round((today - date) / 1000);
            const minutes = Math.round(seconds / 60);
            const isToday = today.toDateString() === date.toDateString();
            const isYesterday = yesterday.toDateString() === date.toDateString();
            const isThisYear = today.getFullYear() === date.getFullYear();


            if (seconds < 5) {
                return 'now';
            } else if (seconds < 60) {
                return `${seconds} seconds ago`;
            } else if (seconds < 90) {
                return 'about a minute ago';
            } else if (minutes < 60) {
                return `${minutes} minutes ago`;
            } else if (isToday) {
                return getFormattedDate(date, 'Today'); // Today at 10:20
            } else if (isYesterday) {
                return getFormattedDate(date, 'Yesterday'); // Yesterday at 10:20
            } else if (isThisYear) {
                return getFormattedDate(date, false, true); // 10. January at 10:20
            }

            return getFormattedDate(date); // 10. January 2017. at 10:20
        }


        //Emojis

        $('#message-to-send').emojiInit();
        $('#annotation-comment').emojiInit();
        $('#reply-comment').emojiInit();
        $('#edit-comment').emojiInit();


        //Tags

        function getTags(id) {
            $('#' + id).mentionsInput('getMentions', function (data) {
                tags = JSON.stringify(data);
            });
        }


        try {
            timeago.render(document.querySelectorAll('.timeago_rendering'));
        } catch (e) {

        }


        /*
        Draw arrow:
        (function(target) {
  if (!target || !target.prototype)
    return;
  target.prototype.arrow = function(startX, startY, endX, endY, controlPoints) {
    var dx = endX - startX;
    var dy = endY - startY;
    var len = Math.sqrt(dx * dx + dy * dy);
    var sin = dy / len;
    var cos = dx / len;
    var a = [];
    a.push(0, 0);
    for (var i = 0; i < controlPoints.length; i += 2) {
      var x = controlPoints[i];
      var y = controlPoints[i + 1];
      a.push(x < 0 ? len + x : x, y);
    }
    a.push(len, 0);
    for (var i = controlPoints.length; i > 0; i -= 2) {
      var x = controlPoints[i - 2];
      var y = controlPoints[i - 1];
      a.push(x < 0 ? len + x : x, -y);
    }
    a.push(0, 0);
    for (var i = 0; i < a.length; i += 2) {
      var x = a[i] * cos - a[i + 1] * sin + startX;
      var y = a[i] * sin + a[i + 1] * cos + startY;
      if (i === 0) this.moveTo(x, y);
      else this.lineTo(x, y);
    }
  };
})(CanvasRenderingContext2D);
Ex.
var colors = ["#000000", "#ffffff", "#ffcc00"];
    var c = document.getElementById("canvas").getContext("2d");
    c.lineWidth = 1;
    c.strokeStyle = "#ffffff";
    c.fillStyle = "#ffffff";

    c.setTransform(1, 0, 0, 1, 20, 0);

    // small
    c.translate(0, 40);
    c.beginPath();
    c.arrow(0, 0, 200, 100, [0, 1, -10, 2, -10, 5]);
    c.fill();

    // medium
    c.translate(0, 40);
    c.beginPath();
    c.arrow(0, 0, 200, 100, [20, 0, -20, 2, -20, 8]);
    c.fill();

    // big
    c.translate(0, 40);
    c.beginPath();
    c.arrow(0, 0, 200, 100, [0, 5, -20, 5, -20, 15]);
    c.fill();

    // array with stroke
    c.translate(0, 40);
    c.beginPath();
    c.arrow(0, 0, 200, 100, [0, 2, -12, 2, -20, 10]);
    c.fill();

    // box
    c.translate(0, 40);
    c.beginPath();
    c.arrow(0, 0, 200, 100, [0, 1, -15, 1, -15, 8, -Number.MIN_VALUE, 8]);
    c.fill();
         */


        // zoom

        /* const element = document.getElementById('zoomArea')
         const panzoom = Panzoom(element, {
             panOnlyWhenZoomed: true,
             startScale: 1,
             minScale:1,
             disablePan: true,
             contain:"outside"

             // options here
         });

         // enable mouse wheel
         const parent = element.parentElement
         parent.addEventListener('wheel', panzoom.zoomWithWheel);*/


        $(document).ready(function () {

            loadData();
            @if(!$isSubmited)
            if (localStorage.getItem('selectedColor') != null) {

                pad.setLineColor(localStorage.getItem('selectedColor'));
            }
            @endif

        });


        function showSavingStatus(status, el){
            $('#'+el).fadeIn();
            switch(status){
                case 'saving':
                    $('#'+el).html('<svg class="mb-3" width="59" height="14" viewBox="0 0 59 14" fill="none" xmlns="http://www.w3.org/2000/svg"> <g clip-path="url(#clip0_1165_2937)"> <path fill-rule="evenodd" clip-rule="evenodd" d="M8 2C5.8811 2 4.09292 3.36896 3.52306 5.24432C1.55107 5.39749 0 6.99787 0 8.94948C0 11.0024 1.71624 12.6667 3.83333 12.6667H12.1666C14.2837 12.6667 16 11.0024 16 8.94948C16 6.99787 14.4489 5.39749 12.4769 5.24432C11.9071 3.36896 10.1189 2 8 2Z" fill="#B5B5B5"/> <path d="M10.6673 7.99998C10.6673 8.61693 10.4534 9.21479 10.062 9.6917C9.67063 10.1686 9.12599 10.495 8.52089 10.6154C7.9158 10.7358 7.28769 10.6426 6.74359 10.3518C6.19949 10.0609 5.77307 9.59045 5.53697 9.02047C5.30088 8.45048 5.26972 7.81627 5.44881 7.22589C5.6279 6.63551 6.00616 6.12549 6.51913 5.78273C7.0321 5.43997 7.64805 5.28568 8.26203 5.34615C8.87601 5.40663 9.45002 5.67811 9.88627 6.11436" stroke="white"/> </g> <path d="M24.228 9.572C24.492 9.572 24.708 9.552 24.876 9.512C25.052 9.464 25.192 9.404 25.296 9.332C25.4 9.252 25.472 9.16 25.512 9.056C25.552 8.952 25.572 8.836 25.572 8.708C25.572 8.436 25.444 8.212 25.188 8.036C24.932 7.852 24.492 7.656 23.868 7.448C23.596 7.352 23.324 7.244 23.052 7.124C22.78 6.996 22.536 6.84 22.32 6.656C22.104 6.464 21.928 6.236 21.792 5.972C21.656 5.7 21.588 5.372 21.588 4.988C21.588 4.604 21.66 4.26 21.804 3.956C21.948 3.644 22.152 3.38 22.416 3.164C22.68 2.948 23 2.784 23.376 2.672C23.752 2.552 24.176 2.492 24.648 2.492C25.208 2.492 25.692 2.552 26.1 2.672C26.508 2.792 26.844 2.924 27.108 3.068L26.568 4.544C26.336 4.424 26.076 4.32 25.788 4.232C25.508 4.136 25.168 4.088 24.768 4.088C24.32 4.088 23.996 4.152 23.796 4.28C23.604 4.4 23.508 4.588 23.508 4.844C23.508 4.996 23.544 5.124 23.616 5.228C23.688 5.332 23.788 5.428 23.916 5.516C24.052 5.596 24.204 5.672 24.372 5.744C24.548 5.808 24.74 5.876 24.948 5.948C25.38 6.108 25.756 6.268 26.076 6.428C26.396 6.58 26.66 6.76 26.868 6.968C27.084 7.176 27.244 7.42 27.348 7.7C27.452 7.98 27.504 8.32 27.504 8.72C27.504 9.496 27.232 10.1 26.688 10.532C26.144 10.956 25.324 11.168 24.228 11.168C23.86 11.168 23.528 11.144 23.232 11.096C22.936 11.056 22.672 11.004 22.44 10.94C22.216 10.876 22.02 10.808 21.852 10.736C21.692 10.664 21.556 10.596 21.444 10.532L21.972 9.044C22.22 9.18 22.524 9.304 22.884 9.416C23.252 9.52 23.7 9.572 24.228 9.572ZM31.377 9.752C31.553 9.752 31.721 9.748 31.881 9.74C32.041 9.732 32.169 9.72 32.265 9.704V8.348C32.193 8.332 32.085 8.316 31.941 8.3C31.797 8.284 31.665 8.276 31.545 8.276C31.377 8.276 31.217 8.288 31.065 8.312C30.921 8.328 30.793 8.364 30.681 8.42C30.569 8.476 30.481 8.552 30.417 8.648C30.353 8.744 30.321 8.864 30.321 9.008C30.321 9.288 30.413 9.484 30.597 9.596C30.789 9.7 31.049 9.752 31.377 9.752ZM31.233 4.52C31.761 4.52 32.201 4.58 32.553 4.7C32.905 4.82 33.185 4.992 33.393 5.216C33.609 5.44 33.761 5.712 33.849 6.032C33.937 6.352 33.981 6.708 33.981 7.1V10.82C33.725 10.876 33.369 10.94 32.913 11.012C32.457 11.092 31.905 11.132 31.257 11.132C30.849 11.132 30.477 11.096 30.141 11.024C29.813 10.952 29.529 10.836 29.289 10.676C29.049 10.508 28.865 10.292 28.737 10.028C28.609 9.764 28.545 9.44 28.545 9.056C28.545 8.688 28.617 8.376 28.761 8.12C28.913 7.864 29.113 7.66 29.361 7.508C29.609 7.356 29.893 7.248 30.213 7.184C30.533 7.112 30.865 7.076 31.209 7.076C31.441 7.076 31.645 7.088 31.821 7.112C32.005 7.128 32.153 7.152 32.265 7.184V7.016C32.265 6.712 32.173 6.468 31.989 6.284C31.805 6.1 31.485 6.008 31.029 6.008C30.725 6.008 30.425 6.032 30.129 6.08C29.833 6.12 29.577 6.18 29.361 6.26L29.133 4.82C29.237 4.788 29.365 4.756 29.517 4.724C29.677 4.684 29.849 4.652 30.033 4.628C30.217 4.596 30.409 4.572 30.609 4.556C30.817 4.532 31.025 4.52 31.233 4.52ZM37.1615 11C36.7535 10.2 36.3375 9.264 35.9135 8.192C35.4975 7.12 35.1015 5.952 34.7255 4.688H36.6215C36.7015 5 36.7935 5.34 36.8975 5.708C37.0095 6.068 37.1215 6.436 37.2335 6.812C37.3535 7.18 37.4695 7.54 37.5815 7.892C37.7015 8.244 37.8175 8.564 37.9295 8.852C38.0335 8.564 38.1455 8.244 38.2655 7.892C38.3855 7.54 38.5015 7.18 38.6135 6.812C38.7335 6.436 38.8455 6.068 38.9495 5.708C39.0615 5.34 39.1575 5 39.2375 4.688H41.0855C40.7095 5.952 40.3095 7.12 39.8855 8.192C39.4695 9.264 39.0575 10.2 38.6495 11H37.1615ZM43.8311 11H42.0431V4.688H43.8311V11ZM43.9991 2.864C43.9991 3.192 43.8911 3.452 43.6751 3.644C43.4671 3.828 43.2191 3.92 42.9311 3.92C42.6431 3.92 42.3911 3.828 42.1751 3.644C41.9671 3.452 41.8631 3.192 41.8631 2.864C41.8631 2.536 41.9671 2.28 42.1751 2.096C42.3911 1.904 42.6431 1.808 42.9311 1.808C43.2191 1.808 43.4671 1.904 43.6751 2.096C43.8911 2.28 43.9991 2.536 43.9991 2.864ZM45.5119 4.904C45.8159 4.816 46.2079 4.736 46.6879 4.664C47.1679 4.584 47.6719 4.544 48.1999 4.544C48.7359 4.544 49.1799 4.616 49.5319 4.76C49.8919 4.896 50.1759 5.092 50.3839 5.348C50.5919 5.604 50.7399 5.908 50.8279 6.26C50.9159 6.612 50.9599 7.004 50.9599 7.436V11H49.1719V7.652C49.1719 7.076 49.0959 6.668 48.9439 6.428C48.7919 6.188 48.5079 6.068 48.0919 6.068C47.9639 6.068 47.8279 6.076 47.6839 6.092C47.5399 6.1 47.4119 6.112 47.2999 6.128V11H45.5119V4.904ZM54.1023 7.64C54.1023 8.64 54.5063 9.14 55.3143 9.14C55.4983 9.14 55.6703 9.116 55.8303 9.068C55.9903 9.02 56.1263 8.964 56.2383 8.9V6.044C56.1503 6.028 56.0463 6.016 55.9263 6.008C55.8063 5.992 55.6663 5.984 55.5063 5.984C55.0343 5.984 54.6823 6.14 54.4503 6.452C54.2183 6.764 54.1023 7.16 54.1023 7.64ZM58.0263 10.208C58.0263 11.24 57.7623 12.004 57.2343 12.5C56.7143 13.004 55.9063 13.256 54.8103 13.256C54.4263 13.256 54.0423 13.22 53.6583 13.148C53.2743 13.084 52.9183 12.996 52.5903 12.884L52.9023 11.384C53.1823 11.496 53.4743 11.584 53.7783 11.648C54.0903 11.712 54.4423 11.744 54.8343 11.744C55.3463 11.744 55.7063 11.632 55.9143 11.408C56.1303 11.184 56.2383 10.896 56.2383 10.544V10.316C56.0463 10.404 55.8463 10.472 55.6383 10.52C55.4383 10.56 55.2183 10.58 54.9783 10.58C54.1063 10.58 53.4383 10.324 52.9743 9.812C52.5103 9.292 52.2783 8.568 52.2783 7.64C52.2783 7.176 52.3503 6.756 52.4943 6.38C52.6383 5.996 52.8463 5.668 53.1183 5.396C53.3983 5.124 53.7383 4.916 54.1383 4.772C54.5383 4.62 54.9903 4.544 55.4943 4.544C55.7103 4.544 55.9303 4.556 56.1543 4.58C56.3863 4.596 56.6143 4.62 56.8383 4.652C57.0623 4.684 57.2743 4.724 57.4743 4.772C57.6823 4.812 57.8663 4.856 58.0263 4.904V10.208Z" fill="#B5B5B5"/> <defs> <clipPath id="clip0_1165_2937"> <rect width="16" height="10.6667" fill="white" transform="translate(0 2)"/> </clipPath> </defs> </svg>');

                    break;

                case 'saved':
                    $('#'+el).html('<svg class="mb-3" width="59" height="14" viewBox="0 0 55 12" fill="none" xmlns="http://www.w3.org/2000/svg"> <path fill-rule="evenodd" clip-rule="evenodd" d="M3.52306 4.24432C4.09292 2.36896 5.8811 1 8 1C10.1189 1 11.9071 2.36896 12.4769 4.24432C14.4489 4.39749 16 5.99787 16 7.94948C16 10.0024 14.2837 11.6667 12.1666 11.6667H3.83333C1.71624 11.6667 0 10.0024 0 7.94948C0 5.99787 1.55107 4.39749 3.52306 4.24432Z" fill="#B5B5B5"/> <path d="M5 7L7.27273 9L10.5 5.5" stroke="white" stroke-linecap="round" stroke-linejoin="round"/> <path d="M24.228 8.572C24.492 8.572 24.708 8.552 24.876 8.512C25.052 8.464 25.192 8.404 25.296 8.332C25.4 8.252 25.472 8.16 25.512 8.056C25.552 7.952 25.572 7.836 25.572 7.708C25.572 7.436 25.444 7.212 25.188 7.036C24.932 6.852 24.492 6.656 23.868 6.448C23.596 6.352 23.324 6.244 23.052 6.124C22.78 5.996 22.536 5.84 22.32 5.656C22.104 5.464 21.928 5.236 21.792 4.972C21.656 4.7 21.588 4.372 21.588 3.988C21.588 3.604 21.66 3.26 21.804 2.956C21.948 2.644 22.152 2.38 22.416 2.164C22.68 1.948 23 1.784 23.376 1.672C23.752 1.552 24.176 1.492 24.648 1.492C25.208 1.492 25.692 1.552 26.1 1.672C26.508 1.792 26.844 1.924 27.108 2.068L26.568 3.544C26.336 3.424 26.076 3.32 25.788 3.232C25.508 3.136 25.168 3.088 24.768 3.088C24.32 3.088 23.996 3.152 23.796 3.28C23.604 3.4 23.508 3.588 23.508 3.844C23.508 3.996 23.544 4.124 23.616 4.228C23.688 4.332 23.788 4.428 23.916 4.516C24.052 4.596 24.204 4.672 24.372 4.744C24.548 4.808 24.74 4.876 24.948 4.948C25.38 5.108 25.756 5.268 26.076 5.428C26.396 5.58 26.66 5.76 26.868 5.968C27.084 6.176 27.244 6.42 27.348 6.7C27.452 6.98 27.504 7.32 27.504 7.72C27.504 8.496 27.232 9.1 26.688 9.532C26.144 9.956 25.324 10.168 24.228 10.168C23.86 10.168 23.528 10.144 23.232 10.096C22.936 10.056 22.672 10.004 22.44 9.94C22.216 9.876 22.02 9.808 21.852 9.736C21.692 9.664 21.556 9.596 21.444 9.532L21.972 8.044C22.22 8.18 22.524 8.304 22.884 8.416C23.252 8.52 23.7 8.572 24.228 8.572ZM31.377 8.752C31.553 8.752 31.721 8.748 31.881 8.74C32.041 8.732 32.169 8.72 32.265 8.704V7.348C32.193 7.332 32.085 7.316 31.941 7.3C31.797 7.284 31.665 7.276 31.545 7.276C31.377 7.276 31.217 7.288 31.065 7.312C30.921 7.328 30.793 7.364 30.681 7.42C30.569 7.476 30.481 7.552 30.417 7.648C30.353 7.744 30.321 7.864 30.321 8.008C30.321 8.288 30.413 8.484 30.597 8.596C30.789 8.7 31.049 8.752 31.377 8.752ZM31.233 3.52C31.761 3.52 32.201 3.58 32.553 3.7C32.905 3.82 33.185 3.992 33.393 4.216C33.609 4.44 33.761 4.712 33.849 5.032C33.937 5.352 33.981 5.708 33.981 6.1V9.82C33.725 9.876 33.369 9.94 32.913 10.012C32.457 10.092 31.905 10.132 31.257 10.132C30.849 10.132 30.477 10.096 30.141 10.024C29.813 9.952 29.529 9.836 29.289 9.676C29.049 9.508 28.865 9.292 28.737 9.028C28.609 8.764 28.545 8.44 28.545 8.056C28.545 7.688 28.617 7.376 28.761 7.12C28.913 6.864 29.113 6.66 29.361 6.508C29.609 6.356 29.893 6.248 30.213 6.184C30.533 6.112 30.865 6.076 31.209 6.076C31.441 6.076 31.645 6.088 31.821 6.112C32.005 6.128 32.153 6.152 32.265 6.184V6.016C32.265 5.712 32.173 5.468 31.989 5.284C31.805 5.1 31.485 5.008 31.029 5.008C30.725 5.008 30.425 5.032 30.129 5.08C29.833 5.12 29.577 5.18 29.361 5.26L29.133 3.82C29.237 3.788 29.365 3.756 29.517 3.724C29.677 3.684 29.849 3.652 30.033 3.628C30.217 3.596 30.409 3.572 30.609 3.556C30.817 3.532 31.025 3.52 31.233 3.52ZM37.1615 10C36.7535 9.2 36.3375 8.264 35.9135 7.192C35.4975 6.12 35.1015 4.952 34.7255 3.688H36.6215C36.7015 4 36.7935 4.34 36.8975 4.708C37.0095 5.068 37.1215 5.436 37.2335 5.812C37.3535 6.18 37.4695 6.54 37.5815 6.892C37.7015 7.244 37.8175 7.564 37.9295 7.852C38.0335 7.564 38.1455 7.244 38.2655 6.892C38.3855 6.54 38.5015 6.18 38.6135 5.812C38.7335 5.436 38.8455 5.068 38.9495 4.708C39.0615 4.34 39.1575 4 39.2375 3.688H41.0855C40.7095 4.952 40.3095 6.12 39.8855 7.192C39.4695 8.264 39.0575 9.2 38.6495 10H37.1615ZM41.5791 6.892C41.5791 6.332 41.6631 5.844 41.8311 5.428C42.0071 5.004 42.2351 4.652 42.5151 4.372C42.7951 4.092 43.1151 3.88 43.4751 3.736C43.8431 3.592 44.2191 3.52 44.6031 3.52C45.4991 3.52 46.2071 3.796 46.7271 4.348C47.2471 4.892 47.5071 5.696 47.5071 6.76C47.5071 6.864 47.5031 6.98 47.4951 7.108C47.4871 7.228 47.4791 7.336 47.4711 7.432H43.4151C43.4551 7.8 43.6271 8.092 43.9311 8.308C44.2351 8.524 44.6431 8.632 45.1551 8.632C45.4831 8.632 45.8031 8.604 46.1151 8.548C46.4351 8.484 46.6951 8.408 46.8951 8.32L47.1351 9.772C47.0391 9.82 46.9111 9.868 46.7511 9.916C46.5911 9.964 46.4111 10.004 46.2111 10.036C46.0191 10.076 45.8111 10.108 45.5871 10.132C45.3631 10.156 45.1391 10.168 44.9151 10.168C44.3471 10.168 43.8511 10.084 43.4271 9.916C43.0111 9.748 42.6631 9.52 42.3831 9.232C42.1111 8.936 41.9071 8.588 41.7711 8.188C41.6431 7.788 41.5791 7.356 41.5791 6.892ZM45.7791 6.208C45.7711 6.056 45.7431 5.908 45.6951 5.764C45.6551 5.62 45.5871 5.492 45.4911 5.38C45.4031 5.268 45.2871 5.176 45.1431 5.104C45.0071 5.032 44.8351 4.996 44.6271 4.996C44.4271 4.996 44.2551 5.032 44.1111 5.104C43.9671 5.168 43.8471 5.256 43.7511 5.368C43.6551 5.48 43.5791 5.612 43.5231 5.764C43.4751 5.908 43.4391 6.056 43.4151 6.208H45.7791ZM50.4109 6.796C50.4109 7.348 50.5349 7.792 50.7829 8.128C51.0309 8.464 51.3989 8.632 51.8869 8.632C52.0469 8.632 52.1949 8.628 52.3309 8.62C52.4669 8.604 52.5789 8.588 52.6669 8.572V5.32C52.5549 5.248 52.4069 5.188 52.2229 5.14C52.0469 5.092 51.8669 5.068 51.6829 5.068C50.8349 5.068 50.4109 5.644 50.4109 6.796ZM54.4549 9.796C54.2949 9.844 54.1109 9.892 53.9029 9.94C53.6949 9.98 53.4749 10.016 53.2429 10.048C53.0189 10.08 52.7869 10.104 52.5469 10.12C52.3149 10.144 52.0909 10.156 51.8749 10.156C51.3549 10.156 50.8909 10.08 50.4829 9.928C50.0749 9.776 49.7309 9.56 49.4509 9.28C49.1709 8.992 48.9549 8.648 48.8029 8.248C48.6589 7.84 48.5869 7.384 48.5869 6.88C48.5869 6.368 48.6509 5.908 48.7789 5.5C48.9069 5.084 49.0909 4.732 49.3309 4.444C49.5709 4.156 49.8629 3.936 50.2069 3.784C50.5589 3.632 50.9589 3.556 51.4069 3.556C51.6549 3.556 51.8749 3.58 52.0669 3.628C52.2669 3.676 52.4669 3.744 52.6669 3.832V0.976L54.4549 0.688V9.796Z" fill="#B5B5B5"/> </svg>');

                    setTimeout(function (){

                        $('#'+el).html('<svg class="mb-3" width="59" height="14" viewBox="0 0 55 12" fill="none" xmlns="http://www.w3.org/2000/svg"> <path fill-rule="evenodd" clip-rule="evenodd" d="M3.52306 4.24432C4.09292 2.36896 5.8811 1 8 1C10.1189 1 11.9071 2.36896 12.4769 4.24432C14.4489 4.39749 16 5.99787 16 7.94948C16 10.0024 14.2837 11.6667 12.1666 11.6667H3.83333C1.71624 11.6667 0 10.0024 0 7.94948C0 5.99787 1.55107 4.39749 3.52306 4.24432Z" fill="#B5B5B5"></path> <path d="M5 7L7.27273 9L10.5 5.5" stroke="white" stroke-linecap="round" stroke-linejoin="round"></path>  </svg>');

                    },1000);
                    break;

                    default:
                        $('#'+el).html('');
                        break;

            }
        }


        $(document).click(function(){
            $(".close").addClass('pulseA');
            $(".webui-popover").addClass('shake');

            setTimeout(function (){
                $(".close").removeClass('pulseA');
                $(".webui-popover").removeClass('shake');
            },500)
        });

        //Change the trigger of tooltip
        $(document).ready(function(){
            $('[rel=tooltip]').tooltip({ trigger: "hover" });
        });

        $(document).ready(function(){
            $('[data-bs-toggle="tooltip"]').click(function () {
                $('[data-bs-toggle="tooltip"]').tooltip("hide");

            });
        });
    </script>





@stop


